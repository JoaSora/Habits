<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Tracker Personal</title>
    <link  rel="icon" href=icon.png type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
    /* Light theme variables */
    --bg-primary: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 50%, #1a1a1a 100%);
    --bg-secondary: linear-gradient(135deg, #f8f9fa, #e9ecef);
    --bg-card: linear-gradient(135deg, #ffffff, #f8f9fa);
    --bg-header: linear-gradient(135deg, #dc3545, #000000);
    --bg-stat: linear-gradient(135deg, #212529, #495057);
    --text-primary: #e0e0e0;
    --text-secondary: #212529;
    --text-muted: #6c757d;
    --border-color: #6c757d;
    --accent-color: #87ceeb;
    --danger-color: #dc3545;
    --success-color: #87ceeb;
}

[data-theme="dark"] {
    /* Dark theme variables */
    --bg-primary: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
    --bg-secondary: linear-gradient(135deg, #1a1a1a, #2c2c2c);
    --bg-card: linear-gradient(135deg, #2c2c2c, #3a3a3a);
    --bg-header: linear-gradient(135deg, #dc3545, #000000);
    --bg-stat: linear-gradient(135deg, #3a3a3a, #4a4a4a);
    --text-primary: #e0e0e0;
    --text-secondary: #e0e0e0;
    --text-muted: #adb5bd;
    --border-color: #495057;
    --accent-color: #87ceeb;
    --danger-color: #dc3545;
    --success-color: #87ceeb;
}

[data-theme="ocean"] {
    --bg-primary: linear-gradient(135deg, #0f3460 0%, #16537e 50%, #0f3460 100%);
    --bg-secondary: linear-gradient(135deg, #e3f2fd, #bbdefb);
    --bg-card: linear-gradient(135deg, #ffffff, #e1f5fe);
    --bg-header: linear-gradient(135deg, #1976d2, #0d47a1);
    --bg-stat: linear-gradient(135deg, #1565c0, #0d47a1);
    --text-primary: #e3f2fd;
    --text-secondary: #0d47a1;
    --text-muted: #1976d2;
    --border-color: #42a5f5;
    --accent-color: #2196f3;
    --danger-color: #f44336;
    --success-color: #4caf50;
}

[data-theme="forest"] {
    --bg-primary: linear-gradient(135deg, #1b5e20 0%, #2e7d32 50%, #1b5e20 100%);
    --bg-secondary: linear-gradient(135deg, #e8f5e8, #c8e6c9);
    --bg-card: linear-gradient(135deg, #ffffff, #f1f8e9);
    --bg-header: linear-gradient(135deg, #388e3c, #1b5e20);
    --bg-stat: linear-gradient(135deg, #2e7d32, #1b5e20);
    --text-primary: #e8f5e8;
    --text-secondary: #1b5e20;
    --text-muted: #388e3c;
    --border-color: #66bb6a;
    --accent-color: #4caf50;
    --danger-color: #f44336;
    --success-color: #8bc34a;
}

[data-theme="sunset"] {
    --bg-primary: linear-gradient(135deg, #bf360c 0%, #d84315 50%, #bf360c 100%);
    --bg-secondary: linear-gradient(135deg, #fff3e0, #ffe0b2);
    --bg-card: linear-gradient(135deg, #ffffff, #fff8e1);
    --bg-header: linear-gradient(135deg, #ff5722, #bf360c);
    --bg-stat: linear-gradient(135deg, #d84315, #bf360c);
    --text-primary: #fff3e0;
    --text-secondary: #bf360c;
    --text-muted: #ff5722;
    --border-color: #ff8a65;
    --accent-color: #ff9800;
    --danger-color: #f44336;
    --success-color: #4caf50;
}

[data-theme="purple"] {
    --bg-primary: linear-gradient(135deg, #4a148c 0%, #6a1b9a 50%, #4a148c 100%);
    --bg-secondary: linear-gradient(135deg, #f3e5f5, #e1bee7);
    --bg-card: linear-gradient(135deg, #ffffff, #fce4ec);
    --bg-header: linear-gradient(135deg, #7b1fa2, #4a148c);
    --bg-stat: linear-gradient(135deg, #6a1b9a, #4a148c);
    --text-primary: #f3e5f5;
    --text-secondary: #4a148c;
    --text-muted: #7b1fa2;
    --border-color: #ba68c8;
    --accent-color: #9c27b0;
    --danger-color: #f44336;
    --success-color: #4caf50;
}

[data-theme="cyberpunk"] {
    --bg-primary: linear-gradient(135deg, #0d1421 0%, #1a252f 50%, #0d1421 100%);
    --bg-secondary: linear-gradient(135deg, #263238, #37474f);
    --bg-card: linear-gradient(135deg, #1e2a3a, #2c3e50);
    --bg-header: linear-gradient(135deg, #00bcd4, #0097a7);
    --bg-stat: linear-gradient(135deg, #34495e, #2c3e50);
    --text-primary: #00e5ff;
    --text-secondary: #00e5ff;
    --text-muted: #4dd0e1;
    --border-color: #00acc1;
    --accent-color: #00bcd4;
    --danger-color: #ff1744;
    --success-color: #00e676;
}

[data-theme="vintage"] {
    --bg-primary: linear-gradient(135deg, #3e2723 0%, #5d4037 50%, #3e2723 100%);
    --bg-secondary: linear-gradient(135deg, #efebe9, #d7ccc8);
    --bg-card: linear-gradient(135deg, #ffffff, #f5f5f5);
    --bg-header: linear-gradient(135deg, #795548, #3e2723);
    --bg-stat: linear-gradient(135deg, #5d4037, #3e2723);
    --text-primary: #efebe9;
    --text-secondary: #3e2723;
    --text-muted: #795548;
    --border-color: #a1887f;
    --accent-color: #8d6e63;
    --danger-color: #f44336;
    --success-color: #4caf50;
}

[data-theme="neon"] {
    --bg-primary: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
    --bg-secondary: linear-gradient(135deg, #1a1a1a, #2d2d2d);
    --bg-card: linear-gradient(135deg, #2d2d2d, #3d3d3d);
    --bg-header: linear-gradient(135deg, #ff0080, #8000ff);
    --bg-stat: linear-gradient(135deg, #3d3d3d, #4d4d4d);
    --text-primary: #00ff41;
    --text-secondary: #00ff41;
    --text-muted: #ff0080;
    --border-color: #8000ff;
    --accent-color: #00ffff;
    --danger-color: #ff0040;
    --success-color: #00ff80;
}

[data-theme="pastel"] {
    --bg-primary: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 50%, #fce4ec 100%);
    --bg-secondary: linear-gradient(135deg, #fff9c4, #f0f4c3);
    --bg-card: linear-gradient(135deg, #ffffff, #fafafa);
    --bg-header: linear-gradient(135deg, #f48fb1, #e91e63);
    --bg-stat: linear-gradient(135deg, #c8e6c9, #a5d6a7);
    --text-primary: #4a4a4a;
    --text-secondary: #2e2e2e;
    --text-muted: #757575;
    --border-color: #e0e0e0;
    --accent-color: #81c784;
    --danger-color: #ef5350;
    --success-color: #66bb6a;
}

[data-theme="monochrome"] {
    --bg-primary: linear-gradient(135deg, #212121 0%, #424242 50%, #212121 100%);
    --bg-secondary: linear-gradient(135deg, #f5f5f5, #e0e0e0);
    --bg-card: linear-gradient(135deg, #ffffff, #fafafa);
    --bg-header: linear-gradient(135deg, #616161, #212121);
    --bg-stat: linear-gradient(135deg, #424242, #212121);
    --text-primary: #f5f5f5;
    --text-secondary: #212121;
    --text-muted: #757575;
    --border-color: #9e9e9e;
    --accent-color: #757575;
    --danger-color: #424242;
    --success-color: #616161;
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            background: var(--bg-header);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.3);
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .theme-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 25px;
    padding: 8px 15px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    min-width: 150px;
}

.theme-toggle:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
}

.theme-toggle option {
    background: #2c2c2c;
    color: white;
}

        .header-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab-btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: 2px solid var(--accent-color);
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tab-btn:hover {
            background: linear-gradient(135deg, var(--accent-color), #5f9ea0);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(135, 206, 235, 0.4);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--accent-color), #5f9ea0);
            color: #000;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(135, 206, 235, 0.4);
        }

        .tab-content {
            display: none;
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title {
            font-size: 1.8rem;
            color: var(--danger-color);
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .btn {
            background: linear-gradient(135deg, var(--danger-color), #c82333);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 2px solid transparent;
        }

        .btn:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #5f9ea0);
            color: #000;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #5f9ea0, #4682b4);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #495057, #343a40);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c82333);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 5px;
        }

        .btn-mini {
            padding: 2px 6px;
            font-size: 10px;
            border-radius: 3px;
            margin-left: 5px;
        }

        /* Charts Section */
        .charts-section {
            margin-bottom: 30px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .chart-card h3 {
            color: var(--text-secondary);
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 250px;
        }

        /* Category Management */
        .category-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-select {
            flex: 1;
        }

        .category-list {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .category-tag {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            border: 1px solid var(--accent-color);
        }

        .category-tag .remove-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Achievements Section */
        .achievements-section {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement-card {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .achievement-card.unlocked {
            border-color: #ffd700;
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            animation: glow 2s infinite alternate;
        }

        .achievement-card.locked {
            opacity: 0.6;
            filter: grayscale(50%);
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px #ffd700; }
            to { box-shadow: 0 0 20px #ffd700, 0 0 30px #ffd700; }
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .achievement-title {
            font-weight: bold;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .achievement-description {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Achievement notification */
        .achievement-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.5s ease;
            max-width: 300px;
        }

        .achievement-notification.show {
            transform: translateX(0);
        }

        .achievement-notification h4 {
            margin-bottom: 5px;
            font-size: 16px;
        }

        .achievement-notification p {
            font-size: 14px;
            margin: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: var(--bg-card);
            color: var(--text-secondary);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.2);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Days selector styles */
        .days-selector {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .day-checkbox {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-card);
        }

        .day-checkbox:hover {
            border-color: var(--accent-color);
            background: var(--bg-secondary);
        }

        .day-checkbox.selected {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, var(--accent-color), #5f9ea0);
            color: white;
        }

        .day-checkbox input {
            display: none;
        }

        .day-checkbox .day-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .day-checkbox .day-initial {
            font-size: 10px;
            opacity: 0.8;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--bg-secondary);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 2px solid var(--border-color);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: var(--danger-color);
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #a71e2a;
        }

        .items-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--danger-color);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-left-color: var(--accent-color);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .item-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-secondary);
            margin: 0;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-stat);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--accent-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--accent-color);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Habits Grid - 2 columns */
        .habits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* Habit Calendar Styles - M√°s compacto */
        .habit-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 12px;
            border-left: 4px solid var(--danger-color);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .habit-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .habit-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 10px;
        }

        .habit-info h3 {
            margin: 0;
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .habit-info p {
            margin: 2px 0;
            color: var(--text-muted);
            font-size: 12px;
        }

        .habit-days {
            display: flex;
            gap: 3px;
            margin: 5px 0;
            flex-wrap: wrap;
        }

        .habit-day-tag {
            background: linear-gradient(135deg, var(--accent-color), #5f9ea0);
            color: #000;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
        }

        .habit-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            margin-top: 8px;
            max-width: 220px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
            font-size: 9px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            min-height: 20px;
        }

        .calendar-day.header {
            background: var(--bg-stat);
            color: var(--accent-color);
            cursor: default;
            font-size: 8px;
        }

        .calendar-day.empty {
            cursor: default;
        }

        .calendar-day.current-month {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-color: var(--border-color);
        }

        .calendar-day.current-month:hover {
            background: var(--bg-card);
            border-color: var(--accent-color);
        }

        .calendar-day.completed {
    background: linear-gradient(135deg, var(--accent-color), #5f9ea0);
    color: #000;
    font-weight: bold;
    box-shadow: 0 2px 8px rgba(135, 206, 235, 0.6);
    transform: scale(1.1);
    border: 2px solid var(--success-color);
}

.calendar-day.completed:hover {
    background: linear-gradient(135deg, #5f9ea0, var(--accent-color));
    transform: scale(1.15);
    box-shadow: 0 4px 12px rgba(135, 206, 235, 0.8);
}

        .calendar-day.today {
            border-color: var(--danger-color);
            border-width: 2px;
            font-weight: bold;
        }

        .calendar-day.disabled {
            background: var(--bg-card);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        .calendar-day.available {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-color: var(--border-color);
        }

        .habit-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            font-size: 11px;
            color: var(--text-muted);
            flex-wrap: wrap;
            gap: 3px;
        }

        /* Finance Section Styles */
        .finance-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .finance-tab {
            background: linear-gradient(135deg, #6c757d, #495057);
            border: 2px solid var(--accent-color);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-weight: 500;
        }

        .finance-tab.active {
            background: linear-gradient(135deg, var(--accent-color), #5f9ea0);
            color: #000;
            font-weight: bold;
        }

        .finance-summary {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .balance-card {
            background: var(--bg-stat);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .balance-amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--accent-color);
        }

        .income-card {
            border-left-color: var(--accent-color);
        }

        .expense-card {
            border-left-color: var(--danger-color);
        }

        .progress-bar {
            background: var(--bg-secondary);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid var(--border-color);
        }

        .progress-fill {
            background: linear-gradient(135deg, var(--accent-color), #5f9ea0);
            height: 100%;
            transition: width 0.3s ease;
        }

        .rating {
            display: flex;
            gap: 5px;
        }

        .star {
            font-size: 20px;
            color: var(--border-color);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .star.filled {
            color: #ffd700;
        }

        .tag {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-block;
            margin: 2px;
            border: 1px solid var(--accent-color);
        }

        .download-section {
            background: var(--bg-stat);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid var(--accent-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .download-section h3 {
            color: var(--accent-color);
            margin-bottom: 15px;
        }

        .download-section p {
            color: #e9ecef;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .download-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .calendar-day {
            font-size: 10px !important;
            width: 32px !important;
            height: 32px !important;
            padding: 2px !important;
            margin: 1px !important;
            aspect-ratio: unset !important;
        }

            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .theme-toggle {
                position: static;
                margin: 10px auto 0;
                display: block;
                width: fit-content;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .habits-grid {
                grid-template-columns: 1fr;
            }

            .habit-calendar {
                max-width: 100%;
                grid-template-columns: repeat(7, 1fr);
                gap: 1px;
            }

            .calendar-day {
                font-size: 8px;
                min-height: 18px;
            }

            .habit-stats {
                font-size: 10px;
            }

            .download-buttons {
                flex-direction: column;
                align-items: center;
            }

            .days-selector {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .achievements-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            .habit-calendar .day-cell {
            width: 40px !important;
            height: 40px !important;
            font-size: 12px !important;
            margin: 2px !important;
        }
        .calendar-day.assigned {
        background-color: var(--accent-color-light);
        color: white;
        border: 2px dashed var(--accent-color);
}}

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <select class="theme-toggle" onchange="changeTheme(this.value)">
    <option value="light">‚òÄÔ∏è Claro</option>
    <option value="dark">üåô Oscuro</option>
    <option value="ocean">üåä Oc√©ano</option>
    <option value="forest">üå≤ Bosque</option>
    <option value="sunset">üåÖ Atardecer</option>
    <option value="purple">üíú P√∫rpura</option>
    <option value="cyberpunk">ü§ñ Cyberpunk</option>
    <option value="vintage">üìú Vintage</option>
    <option value="neon">‚ö° Ne√≥n</option>
    <option value="pastel">üå∏ Pastel</option>
    <option value="monochrome">‚ö´ Monocromo</option>
</select>
            <h1>üéØ Mi Tracker Personal</h1>
            <p>Organiza tu vida, alcanza tus metas</p>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="descargarRespaldo()">üì• Descargar Respaldo</button>
                <button class="btn btn-secondary" onclick="openModal('uploadModal')">üì§ Cargar Respaldo</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="showTab('habits')">‚úÖ H√°bitos</button>
            <button class="tab-btn" onclick="showTab('finances')">üí∞ Finanzas</button>
            <button class="tab-btn" onclick="showTab('media')">üé¨ Pel√≠culas/Series</button>
            <button class="tab-btn" onclick="showTab('books')">üìö Libros</button>
            <button class="tab-btn" onclick="showTab('courses')">üéì Cursos</button>
            <button class="tab-btn" onclick="showTab('journal')">üìù Journal</button>
            <button class="tab-btn" onclick="showTab('achievements')">üèÜ Logros</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2 class="section-title">üìä Dashboard General</h2>
            
            <div class="download-section">
                <h3>üìÑ Reporte Mensual</h3>
                <p>Descarga un reporte detallado de tu progreso del mes actual</p>
                <div class="download-buttons">
                   <button class="btn btn-success" onclick="descargarDatos()">üì• Descargar Datos</button>
                </div>
            </div>

            <div class="stats-grid" id="statsGrid">
                <!-- Stats will be populated by JavaScript -->
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <h3 style="color: var(--text-secondary); margin-bottom: 20px;">üìà An√°lisis Visual</h3>
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>üìä H√°bitos por Categor√≠a</h3>
                        <div class="chart-container">
                            <canvas id="habitsChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>üí∞ Balance Financiero (6 meses)</h3>
                        <div class="chart-container">
                            <canvas id="financeChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>üìà Progreso de H√°bitos (7 d√≠as)</h3>
                        <div class="chart-container">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>üòä Estado de √Ånimo</h3>
                        <div class="chart-container">
                            <canvas id="moodChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>üìñ Libros por G√©nero</h3>
                        <div class="chart-container">
                            <canvas id="bookGenreChart" style="width:100%; height:250px;"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                    <h3>üé¨ G√©neros de Pel√≠culas/Series</h3>
                    <div class="chart-container">
                    <canvas id="mediaGenreChart" style="width:100%; height:250px;"></canvas>
                    </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievements Tab -->
        <div id="achievements" class="tab-content">
            <div class="achievements-section">
                <h2 class="section-title">üèÜ Mis Logros</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Desbloquea logros completando diferentes actividades en tu tracker personal.
                </p>
                <div class="achievements-grid" id="achievementsList">
                    <!-- Achievements will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Habits Tab -->
        <div id="habits" class="tab-content">
           <div class="section-header">
    <h2 class="section-title">‚úÖ Mis H√°bitos</h2>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="btn" onclick="openModal('habitModal')">+ Nuevo H√°bito</button>
        <button class="btn btn-secondary" onclick="mostrarTodosLosHabitos()">üëÅÔ∏è Ver Todos</button>
    </div>
</div>

            <div class="habits-grid" id="habitsList">
                <!-- Habits will be populated by JavaScript -->
            </div>
        </div>

        <!-- Finances Tab -->
        <div id="finances" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">üí∞ Mis Finanzas</h2>
                <div>
                    <button class="btn btn-success" onclick="openModal('incomeModal')">+ Nuevo Ingreso</button>
                    <button class="btn" onclick="openModal('expenseModal')">+ Nuevo Gasto</button>
                </div>
            </div>
            
            <div class="balance-card" id="balanceCard">
                <div class="balance-amount" id="balanceAmount">$0.00</div>
                <div>Balance Total</div>
            </div>

            <div class="finance-tabs">
                <div class="finance-tab active" onclick="showFinanceTab('summary')">üìä Resumen</div>
                <div class="finance-tab" onclick="showFinanceTab('incomes')">üíö Ingresos</div>
                <div class="finance-tab" onclick="showFinanceTab('expenses')">üí∏ Gastos</div>
            </div>

            <div id="financeSummary" class="finance-content active">
                <div id="monthlyFinanceSummary"></div>
            </div>

            <div id="financeIncomes" class="finance-content">
                <div class="items-grid" id="incomesList"></div>
            </div>

            <div id="financeExpenses" class="finance-content">
                <div class="items-grid" id="expensesList"></div>
            </div>
        </div>

        <!-- Media Tab -->
        <div id="media" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">üé¨ Pel√≠culas y Series</h2>
                <button class="btn" onclick="openModal('mediaModal')">+ Agregar Pel√≠cula/Serie</button>
            </div>
            <div class="items-grid" id="mediaList">
                <!-- Media will be populated by JavaScript -->
            </div>
        </div>

        <!-- Books Tab -->
        <div id="books" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">üìö Mis Libros</h2>
                <button class="btn" onclick="openModal('bookModal')">+ Nuevo Libro</button>
            </div>
            <div class="items-grid" id="booksList">
                <!-- Books will be populated by JavaScript -->
            </div>
        </div>

        <!-- Courses Tab -->
        <div id="courses" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">üéì Mis Cursos</h2>
                <button class="btn" onclick="openModal('courseModal')">+ Nuevo Curso</button>
            </div>
            <div class="items-grid" id="coursesList">
                <!-- Courses will be populated by JavaScript -->
            </div>
        </div>

        <!-- Journal Tab -->
        <div id="journal" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">üìù Mi Journal</h2>
                <button class="btn" onclick="openModal('journalModal')">+ Nueva Entrada</button>
            </div>
            <div class="items-grid" id="journalList">
                <!-- Journal entries will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Achievement Notification -->
    <div id="achievementNotification" class="achievement-notification">
        <h4 id="achievementTitle">üèÜ ¬°Logro Desbloqueado!</h4>
        <p id="achievementText"></p>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('uploadModal')">&times;</span>
            <h2>üì§ Cargar Respaldo de Datos</h2>
            <div class="form-group">
                <label for="fileInput">Selecciona tu archivo de respaldo (.json):</label>
                <input type="file" id="fileInput" accept=".json" onchange="loadDataFromFile(event)">
            </div>
            <p style="color: var(--text-muted); font-size: 14px; margin-top: 10px;">
                ‚ö†Ô∏è Esto reemplazar√° todos tus datos actuales con los del archivo de respaldo.
            </p>
        </div>
    </div>

    <!-- Category Management Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('categoryModal')">&times;</span>
            <h2 id="categoryModalTitle">Gestionar Categor√≠as</h2>
            <div class="form-group">
                <label for="newCategoryName">Nueva Categor√≠a:</label>
                <input type="text" id="newCategoryName" placeholder="Nombre de la categor√≠a">
                <button class="btn btn-success" onclick="addNewCategory()" style="margin-top: 10px;">Agregar</button>
            </div>
            <div class="form-group">
                <label>Categor√≠as Existentes:</label>
                <div id="existingCategories" class="category-list">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Habit Modal -->
    <div id="habitModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('habitModal')">&times;</span>
            <h2>‚úÖ Nuevo H√°bito</h2>
            <form id="habitForm">
                <div class="form-group">
                    <label for="habitName">Nombre del H√°bito:</label>
                    <input type="text" id="habitName" required>
                </div>
                <div class="form-group">
                    <label for="habitDescription">Descripci√≥n:</label>
                    <textarea id="habitDescription"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="habitFrequency">Frecuencia:</label>
                        <select id="habitFrequency">
                            <option value="daily">Diario</option>
                            <option value="weekly">Semanal</option>
                            <option value="custom">D√≠as espec√≠ficos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="habitCategory">Categor√≠a:</label>
                        <div class="category-group">
                            <select id="habitCategory" class="category-select">
                                <option value="limpieza">Limpieza</option>
                                <option value="fisico">F√≠sico</option>
                                <option value="conocimiento">Conocimiento</option>
                                <option value="habito">H√°bito</option>
                                <option value="otro">Otro</option>
                            </select>
                            <button type="button" class="btn btn-secondary btn-small" onclick="openCategoryManager('habit')">Gestionar</button>
                        </div>
                    </div>
                </div>
                <div class="form-group" id="daysSelector" style="display: none;">
                    <label>D√≠as de la semana:</label>
                    <div class="days-selector">
                        <div class="day-checkbox" onclick="toggleDay(this, 0)">
                            <input type="checkbox" value="0">
                            <span class="day-name">Dom</span>
                            <span class="day-initial">D</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 1)">
                            <input type="checkbox" value="1">
                            <span class="day-name">Lun</span>
                            <span class="day-initial">L</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 2)">
                            <input type="checkbox" value="2">
                            <span class="day-name">Mar</span>
                            <span class="day-initial">M</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 3)">
                            <input type="checkbox" value="3">
                            <span class="day-name">Mi√©</span>
                            <span class="day-initial">M</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 4)">
                            <input type="checkbox" value="4">
                            <span class="day-name">Jue</span>
                            <span class="day-initial">J</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 5)">
                            <input type="checkbox" value="5">
                            <span class="day-name">Vie</span>
                            <span class="day-initial">V</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 6)">
                            <input type="checkbox" value="6">
                            <span class="day-name">S√°b</span>
                            <span class="day-initial">S</span>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn">Guardar H√°bito</button>
            </form>
        </div>
    </div>

    <!-- Income Modal -->
    <div id="incomeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('incomeModal')">&times;</span>
            <h2>üíö Nuevo Ingreso</h2>
            <form id="incomeForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="incomeAmount">Monto:</label>
                        <input type="number" id="incomeAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="incomeDate">Fecha:</label>
                        <input type="date" id="incomeDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="incomeDescription">Descripci√≥n:</label>
                    <input type="text" id="incomeDescription" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="incomeCategory">Categor√≠a:</label>
                        <div class="category-group">
                            <select id="incomeCategory" class="category-select">
                                <option value="salario">Salario</option>
                                <option value="freelance">Freelance</option>
                                <option value="inversion">Inversi√≥n</option>
                                <option value="regalo">Regalo</option>
                                <option value="venta">Venta</option>
                                <option value="otros">Otros</option>
                            </select>
                            <button type="button" class="btn btn-secondary btn-small" onclick="openCategoryManager('income')">Gestionar</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="incomeRecurring">¬øEs recurrente?</label>
                        <select id="incomeRecurring">
                            <option value="no">No</option>
                            <option value="mensual">Mensual</option>
                            <option value="quincenal">Quincenal</option>
                            <option value="semanal">Semanal</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">Guardar Ingreso</button>
            </form>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('expenseModal')">&times;</span>
            <h2>üí∏ Nuevo Gasto</h2>
            <form id="expenseForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="expenseAmount">Monto:</label>
                        <input type="number" id="expenseAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseDate">Fecha:</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="expenseDescription">Descripci√≥n:</label>
                    <input type="text" id="expenseDescription" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="expenseCategory">Categor√≠a:</label>
                        <div class="category-group">
                            <select id="expenseCategory" class="category-select">
                                <option value="comida">Comida</option>
                                <option value="transporte">Transporte</option>
                                <option value="entretenimiento">Entretenimiento</option>
                                <option value="salud">Salud</option>
                                <option value="educacion">Educaci√≥n</option>
                                <option value="servicios">Servicios</option>
                                <option value="ropa">Ropa</option>
                                <option value="otros">Otros</option>
                            </select>
                            <button type="button" class="btn btn-secondary btn-small" onclick="openCategoryManager('expense')">Gestionar</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="expensePayment">M√©todo de Pago:</label>
                        <select id="expensePayment">
                            <option value="efectivo">Efectivo</option>
                            <option value="tarjeta">Tarjeta</option>
                            <option value="transferencia">Transferencia</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">Guardar Gasto</button>
            </form>
        </div>
    </div>

    <!-- Media Modal -->
    <div id="mediaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('mediaModal')">&times;</span>
            <h2>üé¨ Nueva Pel√≠cula/Serie</h2>
            <form id="mediaForm">
                <div class="form-group">
                    <label for="mediaTitle">T√≠tulo:</label>
                    <input type="text" id="mediaTitle" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mediaType">Tipo:</label>
                        <select id="mediaType">
                            <option value="pelicula">Pel√≠cula</option>
                            <option value="serie">Serie</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mediaYear">A√±o:</label>
                        <input type="number" id="mediaYear" min="1900" max="2030">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mediaGenre">G√©nero:</label>
                        <input type="text" id="mediaGenre">
                    </div>
                    <div class="form-group">
                        <label for="mediaPlatform">Plataforma:</label>
                        <input type="text" id="mediaPlatform">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mediaStatus">Estado:</label>
                        <select id="mediaStatus">
                            <option value="viendo">Viendo</option>
                            <option value="completada">Completada</option>
                            <option value="pausada">Pausada</option>
                            <option value="abandonada">Abandonada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mediaRating">Calificaci√≥n (1-10):</label>
                        <input type="number" id="mediaRating" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="mediaReview">Rese√±a:</label>
                    <textarea id="mediaReview"></textarea>
                </div>
                <button type="submit" class="btn">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Book Modal -->
    <div id="bookModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('bookModal')">&times;</span>
            <h2>üìö Nuevo Libro</h2>
            <form id="bookForm">
                <div class="form-group">
                    <label for="bookTitle">T√≠tulo:</label>
                    <input type="text" id="bookTitle" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookAuthor">Autor:</label>
                        <input type="text" id="bookAuthor" required>
                    </div>
                    <div class="form-group">
                        <label for="bookPages">P√°ginas:</label>
                        <input type="number" id="bookPages" min="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookGenre">G√©nero:</label>
                        <input type="text" id="bookGenre">
                    </div>
                    <div class="form-group">
                        <label for="bookFormat">Formato:</label>
                        <select id="bookFormat">
                            <option value="fisico">F√≠sico</option>
                            <option value="digital">Digital</option>
                            <option value="audiolibro">Audiolibro</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookStatus">Estado:</label>
                        <select id="bookStatus">
                            <option value="leyendo">Leyendo</option>
                            <option value="terminado">Terminado</option>
                            <option value="pausado">Pausado</option>
                            <option value="abandonado">Abandonado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bookRating">Calificaci√≥n (1-10):</label>
                        <input type="number" id="bookRating" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="bookNotes">Notas:</label>
                    <textarea id="bookNotes"></textarea>
                </div>
                <button type="submit" class="btn">Guardar Libro</button>
            </form>
        </div>
    </div>

    <!-- Course Modal -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('courseModal')">&times;</span>
            <h2>üéì Nuevo Curso</h2>
            <form id="courseForm">
                <div class="form-group">
                    <label for="courseName">Nombre del Curso:</label>
                    <input type="text" id="courseName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseInstructor">Instructor:</label>
                        <input type="text" id="courseInstructor">
                    </div>
                    <div class="form-group">
                        <label for="coursePlatform">Plataforma:</label>
                        <input type="text" id="coursePlatform">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseDuration">Duraci√≥n (horas):</label>
                        <input type="number" id="courseDuration" min="1">
                    </div>
                    <div class="form-group">
                        <label for="courseProgress">Progreso (%):</label>
                        <input type="number" id="courseProgress" min="0" max="100" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseStatus">Estado:</label>
                        <select id="courseStatus">
                            <option value="activo">Activo</option>
                            <option value="completado">Completado</option>
                            <option value="pausado">Pausado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="courseRating">Calificaci√≥n (1-10):</label>
                        <input type="number" id="courseRating" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="courseSkills">Habilidades Aprendidas:</label>
                    <textarea id="courseSkills"></textarea>
                </div>
                <button type="submit" class="btn">Guardar Curso</button>
            </form>
        </div>
    </div>

    <!-- Journal Modal -->
    <div id="journalModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('journalModal')">&times;</span>
            <h2>üìù Nueva Entrada de Journal</h2>
            <form id="journalForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="journalDate">Fecha:</label>
                        <input type="date" id="journalDate" required>
                    </div>
                    <div class="form-group">
                        <label for="journalMood">Estado de √Ånimo:</label>
                        <select id="journalMood">
                            <option value="üòÑ">üòÑ Excelente</option>
                            <option value="üòä">üòä Bien</option>
                            <option value="üòê">üòê Normal</option>
                            <option value="üòî">üòî Triste</option>
                            <option value="üò†">üò† Enojado</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="journalTitle">T√≠tulo del D√≠a:</label>
                    <input type="text" id="journalTitle">
                </div>
                <div class="form-group">
                    <label for="journalContent">Reflexiones del D√≠a:</label>
                    <textarea id="journalContent" required></textarea>
                </div>
                <div class="form-group">
                    <label for="journalGratitude">3 Cosas por las que estoy agradecido:</label>
                    <textarea id="journalGratitude"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="journalEnergy">Nivel de Energ√≠a (1-10):</label>
                        <input type="number" id="journalEnergy" min="1" max="10" value="5">
                    </div>
                    <div class="form-group">
                        <label for="journalSleep">Calidad del Sue√±o (1-10):</label>
                        <input type="number" id="journalSleep" min="1" max="10" value="5">
                    </div>
                </div>
                <button type="submit" class="btn">Guardar Entrada</button>
            </form>
        </div>
    </div>

    <script>
        // Data storage
        let data = {
            habits: JSON.parse(localStorage.getItem('habits')) || [],
            incomes: JSON.parse(localStorage.getItem('incomes')) || [],
            expenses: JSON.parse(localStorage.getItem('expenses')) || [],
            media: JSON.parse(localStorage.getItem('media')) || [],
            books: JSON.parse(localStorage.getItem('books')) || [],
            courses: JSON.parse(localStorage.getItem('courses')) || [],
            journal: JSON.parse(localStorage.getItem('journal')) || [],
            achievements: JSON.parse(localStorage.getItem('achievements')) || [],
            settings: JSON.parse(localStorage.getItem('settings')) || { theme: 'light' },
            customCategories: JSON.parse(localStorage.getItem('customCategories')) || {
                habit: [],
                income: [],
                expense: []
            }
        };

        // Charts variables
        let habitsChart, financeChart, progressChart, moodChart, bookGenreChart, monthlyCompletedChart;

        // Current category management context
        let currentCategoryType = '';

        // Default categories
        const defaultCategories = {
            habit: ['limpieza', 'fisico', 'conocimiento', 'habito', 'otro'],
            income: ['salario', 'freelance', 'inversion', 'regalo', 'venta', 'otros'],
            expense: ['comida', 'transporte', 'entretenimiento', 'salud', 'educacion', 'servicios', 'ropa', 'otros']
        };

        // Achievements definitions
        const achievementDefinitions = [
            {
                id: 'first_habit',
                title: 'üéØ Primer Paso',
                description: 'Crea tu primer h√°bito',
                icon: 'üéØ',
                condition: () => data.habits.length >= 1
            },
            {
                id: 'week_streak',
                title: 'üî• Una Semana Fuerte',
                description: 'Mant√©n un h√°bito por 7 d√≠as seguidos',
                icon: 'üî•',
                condition: () => {
                    return data.habits.some(habit => {
                        const stats = getHabitStats(habit);
                        return stats.streak >= 7;
                    });
                }
            },
            {
                id: 'month_streak',
                title: 'üí™ Mes de Hierro',
                description: 'Mant√©n un h√°bito por 30 d√≠as seguidos',
                icon: 'üí™',
                condition: () => {
                    return data.habits.some(habit => {
                        const stats = getHabitStats(habit);
                        return stats.streak >= 30;
                    });
                }
            },
            {
                id: 'five_habits',
                title: '‚ö° Multitarea',
                description: 'Ten 5 h√°bitos activos',
                icon: '‚ö°',
                condition: () => data.habits.length >= 5
            },
            {
                id: 'first_income',
                title: 'üí∞ Primer Ingreso',
                description: 'Registra tu primer ingreso',
                icon: 'üí∞',
                condition: () => data.incomes.length >= 1
            },
            {
                id: 'positive_balance',
                title: 'üìà En Verde',
                description: 'Mant√©n un balance positivo',
                icon: 'üìà',
                condition: () => {
                    const totalIncomes = data.incomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
                    const totalExpenses = data.expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
                    return totalIncomes > totalExpenses;
                }
            },
            {
                id: 'first_book',
                title: 'üìö Bibli√≥filo',
                description: 'Agrega tu primer libro',
                icon: 'üìö',
                condition: () => data.books.length >= 1
            },
            {
                id: 'ten_books',
                title: 'üìñ Biblioteca Personal',
                description: 'Ten 10 libros en tu biblioteca',
                icon: 'üìñ',
                condition: () => data.books.length >= 10
            },
            {
                id: 'first_course',
                title: 'üéì Estudiante',
                description: 'Comienza tu primer curso',
                icon: 'üéì',
                condition: () => data.courses.length >= 1
            },
            {
                id: 'completed_course',
                title: 'üèÜ Graduado',
                description: 'Completa un curso al 100%',
                icon: 'üèÜ',
                condition: () => data.courses.some(course => parseInt(course.progress) >= 100)
            },
            {
                id: 'first_journal',
                title: 'üìù Reflexivo',
                description: 'Escribe tu primera entrada de journal',
                icon: 'üìù',
                condition: () => data.journal.length >= 1
            },
            {
                id: 'week_journal',
                title: 'üìî Semana Reflexiva',
                description: 'Escribe en tu journal por 7 d√≠as seguidos',
                icon: 'üìî',
                condition: () => {
                    if (data.journal.length < 7) return false;
                    const sortedEntries = data.journal.sort((a, b) => new Date(b.date) - new Date(a.date));
                    let streak = 0;
                    let currentDate = new Date();
                    
                    for (let i = 0; i < sortedEntries.length; i++) {
                        const entryDate = new Date(sortedEntries[i].date);
                        const diffDays = Math.floor((currentDate - entryDate) / (1000 * 60 * 60 * 24));
                        
                        if (diffDays === streak) {
                            streak++;
                            if (streak >= 7) return true;
                        } else {
                            break;
                        }
                    }
                    return false;
                }
            },
            {
                id: 'movie_critic',
                title: 'üé¨ Cr√≠tico de Cine',
                description: 'Agrega 5 pel√≠culas o series',
                icon: 'üé¨',
                condition: () => data.media.length >= 5
            },
            {
                id: 'balanced_life',
                title: '‚öñÔ∏è Vida Equilibrada',
                description: 'Ten al menos 1 elemento en cada categor√≠a',
                icon: '‚öñÔ∏è',
                condition: () => {
                    return data.habits.length >= 1 && 
                           data.incomes.length >= 1 && 
                           data.books.length >= 1 && 
                           data.courses.length >= 1 && 
                           data.journal.length >= 1 && 
                           data.media.length >= 1;
                }
            },
            {
                id: 'data_master',
                title: 'üìä Maestro de Datos',
                description: 'Descarga tu primer reporte',
                icon: 'üìä',
                condition: () => localStorage.getItem('reportDownloaded') === 'true'
            },
{
    id: 'habit_master',
    title: 'üéØ Maestro de H√°bitos',
    description: 'Ten 10 h√°bitos activos',
    icon: 'üéØ',
    condition: () => data.habits.length >= 10
},
{
    id: 'three_month_streak',
    title: 'üî• Trimestre Perfecto',
    description: 'Mant√©n un h√°bito por 90 d√≠as seguidos',
    icon: 'üî•',
    condition: () => {
        return data.habits.some(habit => {
            const stats = getHabitStats(habit);
            return stats.streak >= 90;
        });
    }
},
{
    id: 'big_spender',
    title: 'üí∏ Gran Gastador',
    description: 'Registra gastos por m√°s de $1000 en un mes',
    icon: 'üí∏',
    condition: () => {
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        const monthlyExpenses = data.expenses.filter(expense => {
            const expenseDate = new Date(expense.date);
            return expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear;
        });
        const total = monthlyExpenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
        return total > 1000;
    }
},
{
    id: 'bookworm',
    title: 'üêõ Rat√≥n de Biblioteca',
    description: 'Lee 5 libros (estado: terminado)',
    icon: 'üêõ',
    condition: () => data.books.filter(book => book.status === 'terminado').length >= 5
},
{
    id: 'movie_marathon',
    title: 'üçø Marat√≥n de Pel√≠culas',
    description: 'Completa 20 pel√≠culas o series',
    icon: 'üçø',
    condition: () => data.media.filter(item => item.status === 'completada').length >= 20
},
{
    id: 'scholar',
    title: 'üéì Acad√©mico',
    description: 'Completa 3 cursos al 100%',
    icon: 'üéì',
    condition: () => data.courses.filter(course => parseInt(course.progress) >= 100).length >= 3
},
{
    id: 'daily_writer',
    title: '‚úçÔ∏è Escritor Diario',
    description: 'Escribe en tu journal por 30 d√≠as seguidos',
    icon: '‚úçÔ∏è',
    condition: () => {
        if (data.journal.length < 30) return false;
        const sortedEntries = data.journal.sort((a, b) => new Date(b.date) - new Date(a.date));
        let streak = 0;
        let currentDate = new Date();
        
        for (let i = 0; i < sortedEntries.length; i++) {
            const entryDate = new Date(sortedEntries[i].date);
            const diffDays = Math.floor((currentDate - entryDate) / (1000 * 60 * 60 * 24));
            
            if (diffDays === streak) {
                streak++;
                if (streak >= 30) return true;
            } else {
                break;
            }
        }
        return false;
    }
},
{
    id: 'saver',
    title: 'üí∞ Ahorrador',
    description: 'Mant√©n un balance positivo de m√°s de $500',
    icon: 'üí∞',
    condition: () => {
        const totalIncomes = data.incomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
        const totalExpenses = data.expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
        return (totalIncomes - totalExpenses) > 500;
    }
},
{
    id: 'genre_explorer',
    title: 'üé≠ Explorador de G√©neros',
    description: 'Lee libros de 5 g√©neros diferentes',
    icon: 'üé≠',
    condition: () => {
        const genres = new Set(data.books.map(book => book.genre).filter(genre => genre));
        return genres.size >= 5;
    }
},
{
    id: 'mood_tracker',
    title: 'üòä Rastreador de √Ånimo',
    description: 'Registra 50 entradas de journal',
    icon: 'üòä',
    condition: () => data.journal.length >= 50
},
{
    id: 'consistent',
    title: 'üìÖ Consistente',
    description: 'Completa al menos un h√°bito por 7 d√≠as seguidos',
    icon: 'üìÖ',
    condition: () => {
        const last7Days = [];
        for (let i = 0; i < 7; i++) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            last7Days.push(date.toISOString().split('T')[0]);
        }
        
        return last7Days.every(day => {
            return data.habits.some(habit => 
                habit.completedDates && habit.completedDates.includes(day)
            );
        });
    }
},
{
    id: 'organizer',
    title: 'üìã Organizador',
    description: 'Usa todas las categor√≠as del tracker',
    icon: 'üìã',
    condition: () => {
        return data.habits.length >= 1 && 
               data.incomes.length >= 1 && 
               data.expenses.length >= 1 &&
               data.books.length >= 1 && 
               data.courses.length >= 1 && 
               data.journal.length >= 1 && 
               data.media.length >= 1;
    }
}
        ];

        // Category Management Functions
        function openCategoryManager(type) {
            currentCategoryType = type;
            document.getElementById('categoryModalTitle').textContent = `Gestionar Categor√≠as - ${type === 'habit' ? 'H√°bitos' : type === 'income' ? 'Ingresos' : 'Gastos'}`;
            loadExistingCategories();
            openModal('categoryModal');
        }

        function loadExistingCategories() {
            const container = document.getElementById('existingCategories');
            container.innerHTML = '';
            
            const allCategories = [...defaultCategories[currentCategoryType], ...data.customCategories[currentCategoryType]];
            
            allCategories.forEach(category => {
                const isCustom = data.customCategories[currentCategoryType].includes(category);
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category-tag';
                categoryElement.innerHTML = `
                    ${category}
                    ${isCustom ? `<button class="remove-btn" onclick="removeCategory('${category}')">&times;</button>` : ''}
                `;
                container.appendChild(categoryElement);
            });
        }

        function addNewCategory() {
            const newCategoryName = document.getElementById('newCategoryName').value.trim();
            if (!newCategoryName) {
                alert('Por favor ingresa un nombre para la categor√≠a');
                return;
            }
            
            const allCategories = [...defaultCategories[currentCategoryType], ...data.customCategories[currentCategoryType]];
            if (allCategories.includes(newCategoryName.toLowerCase())) {
                alert('Esta categor√≠a ya existe');
                return;
            }
            
            data.customCategories[currentCategoryType].push(newCategoryName.toLowerCase());
            saveData('customCategories');
            loadExistingCategories();
            updateCategorySelect(currentCategoryType);
            document.getElementById('newCategoryName').value = '';
        }

        function removeCategory(categoryName) {
            if (confirm(`¬øEst√°s seguro de que quieres eliminar la categor√≠a "${categoryName}"?`)) {
                const index = data.customCategories[currentCategoryType].indexOf(categoryName);
                if (index > -1) {
                    data.customCategories[currentCategoryType].splice(index, 1);
                    saveData('customCategories');
                    loadExistingCategories();
                    updateCategorySelect(currentCategoryType);
                }
            }
        }

        function updateCategorySelect(type) {
            const selectId = type === 'habit' ? 'habitCategory' : type === 'income' ? 'incomeCategory' : 'expenseCategory';
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = '';
            
            const allCategories = [...defaultCategories[type], ...data.customCategories[type]];
            allCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                select.appendChild(option);
            });
            
            if (allCategories.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        // Theme functionality
        function changeTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    data.settings.theme = theme;
    localStorage.setItem('settings', JSON.stringify(data.settings));
}

function initializeTheme() {
    const savedTheme = data.settings.theme || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    const themeSelect = document.querySelector('.theme-toggle');
    themeSelect.value = savedTheme;
}

        // Save data to localStorage
        function saveData(type) {
            localStorage.setItem(type, JSON.stringify(data[type]));
        }

        // Achievement system
        function checkAchievements() {
            let newAchievements = [];
            
            achievementDefinitions.forEach(achievement => {
                const isUnlocked = data.achievements.includes(achievement.id);
                const conditionMet = achievement.condition();
                
                if (!isUnlocked && conditionMet) {
                    data.achievements.push(achievement.id);
                    newAchievements.push(achievement);
                }
            });
            
            if (newAchievements.length > 0) {
                saveData('achievements');
                newAchievements.forEach(achievement => {
                    showAchievementNotification(achievement);
                });
            }
        }

        function showAchievementNotification(achievement) {
            const notification = document.getElementById('achievementNotification');
            const title = document.getElementById('achievementTitle');
            const text = document.getElementById('achievementText');
            
            title.textContent = `${achievement.icon} ¬°Logro Desbloqueado!`;
            text.textContent = achievement.title + ' - ' + achievement.description;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        function loadAchievements() {
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';
            
            achievementDefinitions.forEach(achievement => {
                const isUnlocked = data.achievements.includes(achievement.id);
                const conditionMet = achievement.condition();
                
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;
                achievementElement.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.title}</div>
                    <div class="achievement-description">${achievement.description}</div>
                    ${isUnlocked ? '<div style="color: #ffd700; font-weight: bold; margin-top: 5px;">‚úì Desbloqueado</div>' : ''}
                `;
                achievementsList.appendChild(achievementElement);
            });
        }

        // Charts functionality
        function createHabitsChart() {
            const ctx = document.getElementById('habitsChart').getContext('2d');
            
            // Count habits by category
            const categories = {};
            data.habits.forEach(habit => {
                categories[habit.category] = (categories[habit.category] || 0) + 1;
            });
            
            if (habitsChart) habitsChart.destroy();
            
            habitsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: [
                            '#87ceeb',
                            '#dc3545',
                            '#ffd700',
                            '#28a745',
                            '#6f42c1',
                            '#fd7e14'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

function createHabitCard(habit) {
    const card = document.createElement('div');
    card.className = 'habit-card';

    const header = document.createElement('div');
    header.className = 'habit-header';

    const info = document.createElement('div');
    info.className = 'habit-info';

    info.innerHTML = `
        <h3>${habit.name}</h3>
        <p><strong>Categor√≠a:</strong> ${habit.category || 'Sin categor√≠a'}</p>
    `;

    const days = document.createElement('div');
    days.className = 'habit-days';

    const diasSemana = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];

let diasTexto;
if (habit.frequency === 'daily') {
    diasTexto = 'Todos los d√≠as';
} else if (habit.allowedDays && habit.allowedDays.length > 0) {
    diasTexto = habit.allowedDays
        .sort((a, b) => a - b)
        .map(d => diasSemana[d])
        .join(', ');
} else {
    diasTexto = 'No asignado';
}


    const diasLabel = document.createElement('p');
    diasLabel.innerHTML = `<strong>D√≠as asignados:</strong> ${diasTexto}`;
    days.appendChild(diasLabel);

    header.appendChild(info);
    card.appendChild(header);
    card.appendChild(days);

    return card;
}

        function createFinanceChart() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            
            // Get last 6 months data
            const months = [];
            const incomeData = [];
            const expenseData = [];
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                const monthIncomes = data.incomes.filter(income => income.date.startsWith(monthYear));
                const monthExpenses = data.expenses.filter(expense => expense.date.startsWith(monthYear));
                
                const totalIncome = monthIncomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
                const totalExpense = monthExpenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
                
                months.push(date.toLocaleDateString('es-ES', { month: 'short', year: '2-digit' }));
                incomeData.push(totalIncome);
                expenseData.push(totalExpense);
            }
            
            if (financeChart) financeChart.destroy();
            
            financeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Ingresos',
                        data: incomeData,
                        backgroundColor: '#87ceeb',
                        borderColor: '#5f9ea0',
                        borderWidth: 1
                    }, {
                        label: 'Gastos',
                        data: expenseData,
                        backgroundColor: '#dc3545',
                        borderColor: '#c82333',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            // Get last 7 days
            const days = [];
            const completionData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                let completedHabits = 0;
                data.habits.forEach(habit => {
                    if (habit.completedDates && habit.completedDates.includes(dateStr)) {
                        completedHabits++;
                    }
                });
                
                days.push(date.toLocaleDateString('es-ES', { weekday: 'short' }));
                completionData.push(completedHabits);
            }
            
            if (progressChart) progressChart.destroy();
            
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'H√°bitos Completados',
                        data: completionData,
                        borderColor: '#87ceeb',
                        backgroundColor: 'rgba(135, 206, 235, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            stepSize: 1
                        }
                    }
                }
            });
        }

        function createMoodChart() {
            const ctx = document.getElementById('moodChart').getContext('2d');
            
            // Count moods
            const moods = {};
            data.journal.forEach(entry => {
                const mood = entry.mood;
                moods[mood] = (moods[mood] || 0) + 1;
            });
            
            if (moodChart) moodChart.destroy();
            
            moodChart = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: Object.keys(moods),
                    datasets: [{
                        data: Object.values(moods),
                        backgroundColor: [
                            '#ffd700',
                            '#87ceeb',
                            '#6c757d',
                            '#dc3545',
                            '#fd7e14'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createBookGenreChart() {
            const ctx = document.getElementById('bookGenreChart').getContext('2d');
            
            // Count books by genre
            const genres = {};
            data.books.forEach(book => {
                if (book.genre) {
                    genres[book.genre] = (genres[book.genre] || 0) + 1;
                }
            });
            
            if (bookGenreChart) bookGenreChart.destroy();
            
            bookGenreChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(genres),
                    datasets: [{
                        label: 'Cantidad',
                        data: Object.values(genres),
                        backgroundColor: '#87ceeb',
                        borderColor: '#5f9ea0',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            stepSize: 1
                        }
                    }
                }
            });
        }

        function renderMediaGenreChart() {
            const genreCounts = {};
            data.media.forEach(item => {
            const genre = item.genre?.trim() || 'Sin g√©nero';
            genreCounts[genre] = (genreCounts[genre] || 0) + 1;
            });

            const ctx = document.getElementById('mediaGenreChart').getContext('2d');
            if (window.mediaGenreChart) window.mediaGenreChart.destroy();
            window.mediaGenreChart = new Chart(ctx, {
            type: 'bar',
            data: {
            labels: Object.keys(genreCounts),
            datasets: [{
                label: 'Cantidad',
                data: Object.values(genreCounts),
                backgroundColor: 'rgba(135, 206, 235, 0.6)',
                borderColor: 'rgba(135, 206, 235, 1)',
                borderWidth: 1
            }]
            },
            options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                title: { display: false }
            },
            scales: {
                x: {
                    ticks: {
                        color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                    }
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                    }
                }
            }
            }
            });
        }


        function createMonthlyCompletedChart() {
    const ctx = document.getElementById('monthlyCompletedChart').getContext('2d');
    
    const currentMonth = new Date().getMonth();
    const currentYear = new Date().getFullYear();
    
    // Get completed media this month
    const completedMedia = data.media.filter(item => {
        if (item.status === 'completada' && item.createdAt) {
            const date = new Date(item.createdAt);
            return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
        }
        return false;
    });
    
    if (monthlyCompletedChart) monthlyCompletedChart.destroy();
    
    monthlyCompletedChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: completedMedia.map(item => item.title.length > 15 ? item.title.substring(0, 15) + '...' : item.title),
            datasets: [{
                label: 'Completadas este mes',
                data: completedMedia.map(() => 1),
                backgroundColor: completedMedia.map(item => item.type === 'pelicula' ? '#87ceeb' : '#dc3545'),
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    stepSize: 1,
                    max: Math.max(1, completedMedia.length)
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

        function updateAllCharts() {
            createHabitsChart();
            createFinanceChart();
            createProgressChart();
            createMoodChart();
            createBookGenreChart();
            createMonthlyCompletedChart();
        }

        // Get month name in Spanish
        function getMonthName(monthIndex) {
            const months = [
                'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
                'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
            ];
            return months[monthIndex];
        }

        // Generate monthly report
        function generateMonthlyReport() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const monthName = getMonthName(currentMonth);

            let report = `üéØ REPORTE MENSUAL - ${monthName.toUpperCase()} ${currentYear}\n`;
            report += `${'='.repeat(50)}\n\n`;

            // H√ÅBITOS SECTION
            report += `‚úÖ H√ÅBITOS\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyHabits = {};
            data.habits.forEach(habit => {
                if (habit.completedDates) {
                    const monthlyCount = habit.completedDates.filter(date => {
                        const d = new Date(date);
                        return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
                    }).length;
                    
                    if (monthlyCount > 0) {
                        monthlyHabits[habit.name] = monthlyCount;
                    }
                }
            });

            if (Object.keys(monthlyHabits).length > 0) {
                report += `Este mes se realizaron estos h√°bitos:\n\n`;
                Object.entries(monthlyHabits).forEach(([habit, count]) => {
                    report += `‚Ä¢ ${habit}: ${count} veces\n`;
                });
                report += `\nTotal de h√°bitos activos: ${data.habits.length}\n`;
            } else {
                report += `No se registraron h√°bitos completados este mes.\n`;
            }

            // FINANZAS SECTION
            report += `\nüí∞ FINANZAS\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyIncomes = data.incomes.filter(income => {
                const incomeDate = new Date(income.date);
                return incomeDate.getMonth() === currentMonth && incomeDate.getFullYear() === currentYear;
            });
            
            const monthlyExpenses = data.expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear;
            });

            const totalIncomes = monthlyIncomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
            const totalExpenses = monthlyExpenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const balance = totalIncomes - totalExpenses;

            report += `Este mes tuviste un movimiento financiero de:\n\n`;
            report += `üíö Ingresos totales: $${totalIncomes.toFixed(2)}\n`;
            report += `üí∏ Gastos totales: $${totalExpenses.toFixed(2)}\n`;
            report += `üìä Balance del mes: $${balance.toFixed(2)}\n`;
            report += `üìà Transacciones registradas: ${monthlyIncomes.length + monthlyExpenses.length}\n`;

            // ENTRETENIMIENTO SECTION
            report += `\nüé¨ ENTRETENIMIENTO\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyMedia = data.media.filter(item => {
                if (item.createdAt) {
                    const createdDate = new Date(item.createdAt);
                    return createdDate.getMonth() === currentMonth && createdDate.getFullYear() === currentYear;
                }
                return false;
            });

            if (monthlyMedia.length > 0) {
                report += `Este mes agregaste ${monthlyMedia.length} nuevas pel√≠culas/series a tu lista:\n\n`;
                monthlyMedia.forEach(item => {
                    report += `‚Ä¢ ${item.title} (${item.type}) - Estado: ${item.status}\n`;
                });
            } else {
                report += `No agregaste nuevas pel√≠culas o series este mes.\n`;
            }
            report += `\nTotal en tu biblioteca: ${data.media.length} t√≠tulos\n`;

            // LIBROS SECTION
            report += `\nüìö LIBROS\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyBooks = data.books.filter(book => {
                if (book.createdAt) {
                    const createdDate = new Date(book.createdAt);
                    return createdDate.getMonth() === currentMonth && createdDate.getFullYear() === currentYear;
                }
                return false;
            });

            if (monthlyBooks.length > 0) {
                report += `Este mes agregaste ${monthlyBooks.length} nuevos libros a tu biblioteca:\n\n`;
                monthlyBooks.forEach(book => {
                    report += `‚Ä¢ "${book.title}" por ${book.author} - Estado: ${book.status}\n`;
                });
            } else {
                report += `No agregaste nuevos libros este mes.\n`;
            }
            report += `\nTotal en tu biblioteca: ${data.books.length} libros\n`;

            // CURSOS SECTION
            report += `\nüéì CURSOS\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyCourses = data.courses.filter(course => {
                if (course.createdAt) {
                    const createdDate = new Date(course.createdAt);
                    return createdDate.getMonth() === currentMonth && createdDate.getFullYear() === currentYear;
                }
                return false;
            });

            if (monthlyCourses.length > 0) {
                report += `Este mes comenzaste ${monthlyCourses.length} nuevos cursos:\n\n`;
                monthlyCourses.forEach(course => {
                    report += `‚Ä¢ ${course.name} - Progreso: ${course.progress}% - Estado: ${course.status}\n`;
                });
            } else {
                report += `No comenzaste nuevos cursos este mes.\n`;
            }
            report += `\nTotal de cursos: ${data.courses.length}\n`;

            // JOURNAL SECTION
            report += `\nüìù JOURNAL\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyJournal = data.journal.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getMonth() === currentMonth && entryDate.getFullYear() === currentYear;
            });

            if (monthlyJournal.length > 0) {
                report += `Este mes escribiste ${monthlyJournal.length} entradas en tu journal:\n\n`;
                
                // Calcular promedios
                const avgEnergy = monthlyJournal.reduce((sum, entry) => sum + parseInt(entry.energy), 0) / monthlyJournal.length;
                const avgSleep = monthlyJournal.reduce((sum, entry) => sum + parseInt(entry.sleep), 0) / monthlyJournal.length;
                
                report += `üìä Estad√≠sticas del mes:\n`;
                report += `‚Ä¢ Promedio de energ√≠a: ${avgEnergy.toFixed(1)}/10\n`;
                report += `‚Ä¢ Promedio de calidad de sue√±o: ${avgSleep.toFixed(1)}/10\n`;
                report += `‚Ä¢ D√≠as registrados: ${monthlyJournal.length}\n`;
            } else {
                report += `No escribiste entradas en tu journal este mes.\n`;
            }
            report += `\nTotal de entradas: ${data.journal.length}\n`;

            // LOGROS SECTION
            report += `\nüèÜ LOGROS\n`;
            report += `${'-'.repeat(20)}\n`;
            report += `Logros desbloqueados: ${data.achievements.length}/${achievementDefinitions.length}\n\n`;
            
            if (data.achievements.length > 0) {
                report += `Logros obtenidos:\n`;
                data.achievements.forEach(achievementId => {
                    const achievement = achievementDefinitions.find(a => a.id === achievementId);
                    if (achievement) {
                        report += `‚Ä¢ ${achievement.icon} ${achievement.title}\n`;
                    }
                });
            }

            // RESUMEN FINAL
            report += `\nüéØ RESUMEN DEL MES\n`;
            report += `${'-'.repeat(20)}\n`;
            report += `‚Ä¢ H√°bitos completados: ${Object.values(monthlyHabits).reduce((a, b) => a + b, 0)} veces\n`;
            report += `‚Ä¢ Balance financiero: $${balance.toFixed(2)}\n`;
            report += `‚Ä¢ Nuevo contenido agregado: ${monthlyMedia.length + monthlyBooks.length + monthlyCourses.length} elementos\n`;
            report += `‚Ä¢ Entradas de journal: ${monthlyJournal.length}\n`;
            report += `‚Ä¢ Logros desbloqueados: ${data.achievements.length}\n`;
            
            report += `\n${'='.repeat(50)}\n`;
            report += `Reporte generado el ${today.toLocaleDateString('es-ES')}\n`;
            report += `¬°Sigue as√≠! üöÄ\n`;

            return report;
        }

        // Download monthly report as TXT
        function downloadMonthlyReport() {
            const today = new Date();
            const monthName = getMonthName(today.getMonth());
            const year = today.getFullYear();
            
            const reportContent = generateMonthlyReport();
            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${monthName}-${year}.txt`;
            link.click();
            
            // Mark report as downloaded for achievement
            localStorage.setItem('reportDownloaded', 'true');
            checkAchievements();
            
            alert(`üìÑ Reporte de ${monthName} ${year} descargado exitosamente!`);
        }

        // Day selector functionality
        function toggleDay(element, dayIndex) {
            const checkbox = element.querySelector('input');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('selected', checkbox.checked);
        }

        // Show/hide days selector based on frequency
        document.getElementById('habitFrequency').addEventListener('change', function() {
            const daysSelector = document.getElementById('daysSelector');
            if (this.value === 'custom') {
                daysSelector.style.display = 'block';
            } else {
                daysSelector.style.display = 'none';
                // Reset all day selections
                document.querySelectorAll('.day-checkbox').forEach(day => {
                    day.classList.remove('selected');
                    day.querySelector('input').checked = false;
                });
            }
        });

        // Load data from file (keeping JSON backup functionality)
        function loadDataFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    const requiredKeys = ['habits', 'incomes', 'expenses', 'media', 'books', 'courses', 'journal'];
                    const hasAllKeys = requiredKeys.every(key => importedData.hasOwnProperty(key));
                    
                    if (!hasAllKeys) {
                        alert('‚ùå Error: El archivo no tiene el formato correcto.');
                        return;
                    }

                    const confirmReplace = confirm(
                        '‚ö†Ô∏è ¬øEst√°s seguro de que quieres reemplazar todos tus datos actuales?\n\n' +
                        'Esta acci√≥n no se puede deshacer. Se recomienda hacer un respaldo de tus datos actuales primero.'
                    );

                    if (confirmReplace) {
                        data.habits = importedData.habits || [];
                        data.incomes = importedData.incomes || [];
                        data.expenses = importedData.expenses || [];
                        data.media = importedData.media || [];
                        data.books = importedData.books || [];
                        data.courses = importedData.courses || [];
                        data.journal = importedData.journal || [];
                        data.achievements = importedData.achievements || [];
                        data.customCategories = importedData.customCategories || {
                            habit: [],
                            income: [],
                            expense: []
                        };

                        Object.keys(data).forEach(key => {
                            if (key !== 'settings') {
                                localStorage.setItem(key, JSON.stringify(data[key]));
                            }
                        });

                        closeModal('uploadModal');
                        loadDashboard();
                        checkAchievements();
                        
                        alert('‚úÖ Datos cargados exitosamente!\n\nTodos tus datos han sido restaurados desde el archivo de respaldo.');
                    }
                } catch (error) {
                    alert('‚ùå Error al leer el archivo: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Tab functionality
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                loadDashboard();
                updateAllCharts();
            } else if (tabName === 'habits') loadHabits();
            else if (tabName === 'finances') loadFinances();
            else if (tabName === 'media') loadMedia();
            else if (tabName === 'books') loadBooks();
            else if (tabName === 'courses') loadCourses();
            else if (tabName === 'journal') loadJournal();
            else if (tabName === 'achievements') loadAchievements();
        }

        // Finance tab functionality
        function showFinanceTab(tabName) {
            document.querySelectorAll('.finance-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.finance-content').forEach(content => {
                content.style.display = 'none';
            });

            event.target.classList.add('active');
            
            if (tabName === 'summary') {
                document.getElementById('financeSummary').style.display = 'block';
                loadFinanceSummary();
            } else if (tabName === 'incomes') {
                document.getElementById('financeIncomes').style.display = 'block';
                loadIncomes();
            } else if (tabName === 'expenses') {
                document.getElementById('financeExpenses').style.display = 'block';
                loadExpenses();
            }
        }

        // Modal functionality
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll(`#${modalId} input[type="date"]`);
            dateInputs.forEach(input => {
                if (!input.value) input.value = today;
            });

            // Update category selects when opening modals
            if (modalId === 'habitModal') {
                updateCategorySelect('habit');
            } else if (modalId === 'incomeModal') {
                updateCategorySelect('income');
            } else if (modalId === 'expenseModal') {
                updateCategorySelect('expense');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
            
            // Reset day selector
            if (modalId === 'habitModal') {
                document.getElementById('daysSelector').style.display = 'none';
                document.querySelectorAll('.day-checkbox').forEach(day => {
                    day.classList.remove('selected');
                    day.querySelector('input').checked = false;
                });
            }
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Dashboard functions
        function loadDashboard() {
            const statsGrid = document.getElementById('statsGrid');
            const totalHabits = data.habits.length;
            const totalIncomes = data.incomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
            const totalExpenses = data.expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const balance = totalIncomes - totalExpenses;
            const totalMedia = data.media.length;
            const totalBooks = data.books.length;
            const totalCourses = data.courses.length;
            const totalJournalEntries = data.journal.length;

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalHabits}</div>
                    <div class="stat-label">H√°bitos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">$${balance.toFixed(2)}</div>
                    <div class="stat-label">Balance</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalMedia}</div>
                    <div class="stat-label">Pel√≠culas/Series</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalBooks}</div>
                    <div class="stat-label">Libros</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalCourses}</div>
                    <div class="stat-label">Cursos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalJournalEntries}</div>
                    <div class="stat-label">Entradas de Journal</div>
                </div>
            `;
        }

        // Calendar functions for habits
        function generateCalendar(year, month, habitId) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
            const todayDate = today.getDate();

            const habit = data.habits.find(h => h.id === habitId);
            const allowedDays = habit.allowedDays || [];

            let calendar = '';
            
            // Headers
            const dayHeaders = ['D', 'L', 'M', 'M', 'J', 'V', 'S'];
            dayHeaders.forEach(day => {
                calendar += `<div class="calendar-day header">${day}</div>`;
            });

            // Empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                calendar += '<div class="calendar-day empty"></div>';
            }

            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayOfWeek = new Date(year, month, day).getDay();
                const isCompleted = habit && habit.completedDates && habit.completedDates.includes(dateStr);
                const isToday = isCurrentMonth && day === todayDate;
                const isAllowed = allowedDays.length === 0 || allowedDays.includes(dayOfWeek);
                
                let classes = 'calendar-day current-month';
if (isCompleted) classes += ' completed';
if (isToday) classes += ' today';
if (!isAllowed) {
    classes += ' disabled';
} else {
    classes += ' available';

    // Agrega esta secci√≥n para marcar como "asignado" si est√° en habit.assignedDays
    if (habit.assignedDays && habit.assignedDays.includes(dateStr)) {
        classes += ' assigned';
    }
}

                
                const clickHandler = isAllowed ? `onclick="toggleHabitDay('${habitId}', '${dateStr}')"` : '';
                
                calendar += `<div class="${classes}" ${clickHandler}>${day}</div>`;
            }

            return calendar;
        }

    function toggleHabitDay(habitId, dateStr) {
  const habitIndex = data.habits.findIndex(h => h.id === habitId);
  if (habitIndex === -1) return;

  const habit = data.habits[habitIndex];
  if (!habit.completedDates) habit.completedDates = [];

  const idx = habit.completedDates.indexOf(dateStr);
  if (idx > -1) {
    habit.completedDates.splice(idx, 1); // quitar si ya estaba
  } else {
    habit.completedDates.push(dateStr); // a√±adir si no estaba
  }

  saveData('habits');
  loadHabits(); // vuelve a renderizar el calendario y las estad√≠sticas
  checkAchievements();
}




        function getHabitStats(habit) {
            if (!habit.completedDates) return { streak: 0, thisMonth: 0, total: 0 };

            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            const thisMonth = habit.completedDates.filter(date => {
                const d = new Date(date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).length;

            let streak = 0;
            const sortedDates = habit.completedDates.sort().reverse();
            let checkDate = new Date(today);
            
            for (const dateStr of sortedDates) {
                const date = new Date(dateStr);
                const diffTime = checkDate - date;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0 || diffDays === 1) {
                    streak++;
                    checkDate = date;
                } else {
                    break;
                }
            }

            return {
                streak,
                thisMonth,
                total: habit.completedDates.length
            };
        }

        function getDayNames(allowedDays) {
            const dayNames = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
            return allowedDays.map(day => dayNames[day]);
        }

        function loadHabits() {
    const habitsList = document.getElementById('habitsList');
    habitsList.innerHTML = '';

    const today = new Date();
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth();
    const todayDayOfWeek = today.getDay(); // 0 = domingo

    const todaysHabits = data.habits.filter(habit => {
        if (habit.frequency === 'daily') return true;
        if (habit.frequency === 'weekly') return habit.allowedDays?.includes(todayDayOfWeek);
        if (habit.frequency === 'custom') return habit.allowedDays?.includes(todayDayOfWeek);
        return false;
    });

    todaysHabits.forEach((habit, index) => {
        const stats = getHabitStats(habit);
        const calendar = generateCalendar(currentYear, currentMonth, habit.id);

        let daysDisplay = '';
        if (habit.frequency === 'custom' && habit.allowedDays && habit.allowedDays.length > 0) {
            const dayNames = getDayNames(habit.allowedDays);
            daysDisplay = `<div class="habit-days">
                ${dayNames.map(day => `<span class="habit-day-tag">${day}</span>`).join('')}
            </div>`;
        }

        const habitElement = document.createElement('div');
        habitElement.className = 'habit-card';
        habitElement.innerHTML = `
            <div class="habit-header">
                <div class="habit-info">
                    <h3>${habit.name}</h3>
                    <p>${habit.description}</p>
                    <div>
                        <span class="tag">${habit.category}</span>
                        <span class="tag">${habit.frequency === 'custom' ? 'Personalizado' : habit.frequency}</span>
                    </div>
                    ${daysDisplay}
                </div>
                <div class="item-actions">
                    <button class="btn btn-danger btn-small" onclick="deleteHabit(${index})">Eliminar</button>
                </div>
            </div>
            <div class="habit-stats">
                <span><strong>Racha:</strong> ${stats.streak}d</span>
                <span><strong>Este mes:</strong> ${stats.thisMonth}d</span>
                <span><strong>Total:</strong> ${stats.total}d</span>
            </div>
            <div class="habit-calendar">
                ${calendar}
            </div>
        `;
        habitsList.appendChild(habitElement);
    });
}

        function deleteHabit(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este h√°bito?')) {
                data.habits.splice(index, 1);
                saveData('habits');
                loadHabits();
                checkAchievements();
            }
        }

        // Finance functions
        function loadFinances() {
            updateBalance();
            loadFinanceSummary();
        }

        function updateBalance() {
            const totalIncomes = data.incomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
            const totalExpenses = data.expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const balance = totalIncomes - totalExpenses;
            
            const balanceAmount = document.getElementById('balanceAmount');
            balanceAmount.textContent = `$${balance.toFixed(2)}`;
        }

        function loadFinanceSummary() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyIncomes = data.incomes.filter(income => {
                const incomeDate = new Date(income.date);
                return incomeDate.getMonth() === currentMonth && incomeDate.getFullYear() === currentYear;
            });
            
            const monthlyExpenses = data.expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear;
            });

            const monthlyIncomeTotal = monthlyIncomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
            const monthlyExpenseTotal = monthlyExpenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const monthlyBalance = monthlyIncomeTotal - monthlyExpenseTotal;

            // Group by category
            const incomeCategories = {};
            const expenseCategories = {};
            
            monthlyIncomes.forEach(income => {
                incomeCategories[income.category] = (incomeCategories[income.category] || 0) + parseFloat(income.amount);
            });
            
            monthlyExpenses.forEach(expense => {
                expenseCategories[expense.category] = (expenseCategories[expense.category] || 0) + parseFloat(expense.amount);
            });

            const financeSummary = document.getElementById('monthlyFinanceSummary');
            financeSummary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="stat-card" style="background: linear-gradient(135deg, #87ceeb, #5f9ea0); color: #000;">
                        <div class="stat-number">$${monthlyIncomeTotal.toFixed(2)}</div>
                        <div class="stat-label">Ingresos del Mes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #dc3545, #c82333);">
                        <div class="stat-number">$${monthlyExpenseTotal.toFixed(2)}</div>
                        <div class="stat-label">Gastos del Mes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, ${monthlyBalance >= 0 ? '#6c757d, #495057' : '#dc3545, #c82333'});">
                        <div class="stat-number">$${monthlyBalance.toFixed(2)}</div>
                        <div class="stat-label">Balance del Mes</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: var(--bg-card); padding: 20px; border-radius: 10px; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--accent-color); margin-bottom: 15px;">üíö Ingresos por Categor√≠a</h4>
                        ${Object.entries(incomeCategories).map(([category, total]) => 
                            `<div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--text-secondary);">
                                <span>${category}:</span>
                                <strong>$${total.toFixed(2)}</strong>
                            </div>`
                        ).join('') || '<p style="color: var(--text-secondary);">No hay ingresos este mes</p>'}
                    </div>
                    
                    <div style="background: var(--bg-card); padding: 20px; border-radius: 10px; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--danger-color); margin-bottom: 15px;">üí∏ Gastos por Categor√≠a</h4>
                        ${Object.entries(expenseCategories).map(([category, total]) => 
                            `<div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--text-secondary);">
                                <span>${category}:</span>
                                <strong>$${total.toFixed(2)}</strong>
                            </div>`
                        ).join('') || '<p style="color: var(--text-secondary);">No hay gastos este mes</p>'}
                    </div>
                </div>
            `;
        }

        function loadIncomes() {
            const incomesList = document.getElementById('incomesList');
            incomesList.innerHTML = '';

            data.incomes.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((income, index) => {
                const incomeElement = document.createElement('div');
                incomeElement.className = 'item-card income-card';
                incomeElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">+$${parseFloat(income.amount).toFixed(2)} - ${income.description}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteIncome(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Fecha:</strong> ${income.date}</p>
                    <p><strong>Categor√≠a:</strong> ${income.category}</p>
                    <p><strong>Recurrente:</strong> ${income.recurring}</p>
                `;
                incomesList.appendChild(incomeElement);
            });
        }

        function loadExpenses() {
            const expensesList = document.getElementById('expensesList');
            expensesList.innerHTML = '';

            data.expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((expense, index) => {
                const expenseElement = document.createElement('div');
                expenseElement.className = 'item-card expense-card';
                expenseElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">-$${parseFloat(expense.amount).toFixed(2)} - ${expense.description}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteExpense(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Fecha:</strong> ${expense.date}</p>
                    <p><strong>Categor√≠a:</strong> ${expense.category}</p>
                    <p><strong>M√©todo de Pago:</strong> ${expense.payment}</p>
                `;
                expensesList.appendChild(expenseElement);
            });
        }

        function deleteIncome(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este ingreso?')) {
                data.incomes.splice(index, 1);
                saveData('incomes');
                updateBalance();
                loadIncomes();
                loadFinanceSummary();
                checkAchievements();
            }
        }

        function deleteExpense(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este gasto?')) {
                data.expenses.splice(index, 1);
                saveData('expenses');
                updateBalance();
                loadExpenses();
                loadFinanceSummary();
                checkAchievements();
            }
        }

        // Media functions
        function loadMedia() {
            const mediaList = document.getElementById('mediaList');
            mediaList.innerHTML = '';

            data.media.forEach((item, index) => {
                const mediaElement = document.createElement('div');
                mediaElement.className = 'item-card';
                mediaElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">${item.title} (${item.year})</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteMedia(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Tipo:</strong> ${item.type}</p>
                    <p><strong>G√©nero:</strong> ${item.genre}</p>
                    <p><strong>Plataforma:</strong> ${item.platform}</p>
                    <p><strong>Estado:</strong> ${item.status}</p>
                    ${item.rating ? `<p><strong>Calificaci√≥n:</strong> ${item.rating}/10</p>` : ''}
                    ${item.review ? `<p><strong>Rese√±a:</strong> ${item.review}</p>` : ''}
                `;
                mediaList.appendChild(mediaElement);
            });
        }

        function deleteMedia(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este elemento?')) {
                data.media.splice(index, 1);
                saveData('media');
                loadMedia();
                checkAchievements();
            }
        }

        // Books functions
        function loadBooks() {
            const booksList = document.getElementById('booksList');
            booksList.innerHTML = '';

            data.books.forEach((book, index) => {
                const bookElement = document.createElement('div');
                bookElement.className = 'item-card';
                bookElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">${book.title}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteBook(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Autor:</strong> ${book.author}</p>
                    <p><strong>P√°ginas:</strong> ${book.pages}</p>
                    <p><strong>G√©nero:</strong> ${book.genre}</p>
                    <p><strong>Formato:</strong> ${book.format}</p>
                    <p><strong>Estado:</strong> ${book.status}</p>
                    ${book.rating ? `<p><strong>Calificaci√≥n:</strong> ${book.rating}/10</p>` : ''}
                    ${book.notes ? `<p><strong>Notas:</strong> ${book.notes}</p>` : ''}
                `;
                booksList.appendChild(bookElement);
            });
        }

        function deleteBook(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este libro?')) {
                data.books.splice(index, 1);
                saveData('books');
                loadBooks();
                checkAchievements();
            }
        }

        // Courses functions
        function loadCourses() {
            const coursesList = document.getElementById('coursesList');
            coursesList.innerHTML = '';

            data.courses.forEach((course, index) => {
                const courseElement = document.createElement('div');
                courseElement.className = 'item-card';
                courseElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">${course.name}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteCourse(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Instructor:</strong> ${course.instructor}</p>
                    <p><strong>Plataforma:</strong> ${course.platform}</p>
                    <p><strong>Duraci√≥n:</strong> ${course.duration} horas</p>
                    <p><strong>Estado:</strong> ${course.status}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${course.progress}%"></div>
                    </div>
                    <p><strong>Progreso:</strong> ${course.progress}%</p>
                    ${course.rating ? `<p><strong>Calificaci√≥n:</strong> ${course.rating}/10</p>` : ''}
                    ${course.skills ? `<p><strong>Habilidades:</strong> ${course.skills}</p>` : ''}
                `;
                coursesList.appendChild(courseElement);
            });
        }

        function deleteCourse(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este curso?')) {
                data.courses.splice(index, 1);
                saveData('courses');
                loadCourses();
                checkAchievements();
            }
        }

        // Journal functions
        function loadJournal() {
    const journalList = document.getElementById('journalList');
    journalList.innerHTML = '';

    data.journal.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((entry, index) => {
        const journalElement = document.createElement('div');
        journalElement.className = 'item-card';
        journalElement.innerHTML = `
            <div class="item-header">
                <h3 class="item-title">${entry.mood} ${entry.title || 'Entrada del ' + entry.date}</h3>
                <div class="item-actions">
                    <button class="btn btn-danger btn-small" onclick="deleteJournalEntry(${index})">Eliminar</button>
                </div>
            </div>
            <p><strong>Fecha:</strong> ${entry.date}</p>
            <p><strong>Reflexiones:</strong> ${entry.content}</p>
            ${entry.gratitude ? `<p><strong>Gratitud:</strong> ${entry.gratitude}</p>` : ''}
            <p><strong>Energ√≠a:</strong> ${entry.energy}/10 | <strong>Sue√±o:</strong> ${entry.sleep}/10</p>
        `;
        journalList.appendChild(journalElement);
    });
}

function deleteJournalEntry(index) {
    if (confirm('¬øEst√°s seguro de que quieres eliminar esta entrada?')) {
        data.journal.splice(index, 1);
        saveData('journal');
        loadJournal();
        checkAchievements();
    }
}

// Form submissions
document.getElementById('habitForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const frequency = document.getElementById('habitFrequency').value;
    let allowedDays = [];
    
    if (frequency === 'custom') {
        const selectedDays = document.querySelectorAll('.day-checkbox input:checked');
        allowedDays = Array.from(selectedDays).map(input => parseInt(input.value));
        
        if (allowedDays.length === 0) {
            alert('Por favor selecciona al menos un d√≠a de la semana.');
            return;
        }
    }
    
 const habit = {
    id: Date.now().toString(),
    name: document.getElementById('habitName').value,
    description: document.getElementById('habitDescription').value,
    frequency: frequency,
    category: document.getElementById('habitCategory').value,
    allowedDays: allowedDays,
    completedDates: [],
    assignedDays: [], // NUEVO
    createdAt: new Date().toISOString()
};

    
    data.habits.push(habit);
    saveData('habits');
    closeModal('habitModal');
    loadHabits();
    checkAchievements();
});

document.getElementById('incomeForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const income = {
        id: Date.now(),
        amount: document.getElementById('incomeAmount').value,
        date: document.getElementById('incomeDate').value,
        description: document.getElementById('incomeDescription').value,
        category: document.getElementById('incomeCategory').value,
        recurring: document.getElementById('incomeRecurring').value,
        createdAt: new Date().toISOString()
    };
    data.incomes.push(income);
    saveData('incomes');
    closeModal('incomeModal');
    updateBalance();
    loadIncomes();
    loadFinanceSummary();
    checkAchievements();
});

document.getElementById('expenseForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const expense = {
        id: Date.now(),
        amount: document.getElementById('expenseAmount').value,
        date: document.getElementById('expenseDate').value,
        description: document.getElementById('expenseDescription').value,
        category: document.getElementById('expenseCategory').value,
        payment: document.getElementById('expensePayment').value,
        createdAt: new Date().toISOString()
    };
    data.expenses.push(expense);
    saveData('expenses');
    closeModal('expenseModal');
    updateBalance();
    loadExpenses();
    loadFinanceSummary();
    checkAchievements();
});

document.getElementById('mediaForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const media = {
        id: Date.now(),
        title: document.getElementById('mediaTitle').value,
        type: document.getElementById('mediaType').value,
        year: document.getElementById('mediaYear').value,
        genre: document.getElementById('mediaGenre').value,
        platform: document.getElementById('mediaPlatform').value,
        status: document.getElementById('mediaStatus').value,
        rating: document.getElementById('mediaRating').value,
        review: document.getElementById('mediaReview').value,
        createdAt: new Date().toISOString()
    };
    data.media.push(media);
    saveData('media');
    closeModal('mediaModal');
    loadMedia();
    checkAchievements();
});

document.getElementById('bookForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const book = {
        id: Date.now(),
        title: document.getElementById('bookTitle').value,
        author: document.getElementById('bookAuthor').value,
        pages: document.getElementById('bookPages').value,
        genre: document.getElementById('bookGenre').value,
        format: document.getElementById('bookFormat').value,
        status: document.getElementById('bookStatus').value,
        rating: document.getElementById('bookRating').value,
        notes: document.getElementById('bookNotes').value,
        createdAt: new Date().toISOString()
    };
    data.books.push(book);
    saveData('books');
    closeModal('bookModal');
    loadBooks();
    checkAchievements();
});

document.getElementById('courseForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const course = {
        id: Date.now(),
        name: document.getElementById('courseName').value,
        instructor: document.getElementById('courseInstructor').value,
        platform: document.getElementById('coursePlatform').value,
        duration: document.getElementById('courseDuration').value,
        progress: document.getElementById('courseProgress').value,
        status: document.getElementById('courseStatus').value,
        rating: document.getElementById('courseRating').value,
        skills: document.getElementById('courseSkills').value,
        createdAt: new Date().toISOString()
    };
    data.courses.push(course);
    saveData('courses');
    closeModal('courseModal');
    loadCourses();
    checkAchievements();
});

document.getElementById('journalForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const journal = {
        id: Date.now(),
        date: document.getElementById('journalDate').value,
        mood: document.getElementById('journalMood').value,
        title: document.getElementById('journalTitle').value,
        content: document.getElementById('journalContent').value,
        gratitude: document.getElementById('journalGratitude').value,
        energy: document.getElementById('journalEnergy').value,
        sleep: document.getElementById('journalSleep').value,
        createdAt: new Date().toISOString()
    };
    data.journal.push(journal);
    saveData('journal');
    closeModal('journalModal');
    loadJournal();
    checkAchievements();
});

// Initialize the app
document.addEventListener('DOMContentLoaded', function() {
    initializeTheme();
    loadDashboard();
    updateAllCharts();
    checkAchievements();
});

function mostrarTodosLosHabitos() {
    // Simplemente vuelve a renderizar todos los h√°bitos sin importar el d√≠a
    renderHabits(true); // true = mostrar todos
}
function renderHabits(mostrarTodos = false) {
    const container = document.getElementById('habitsList');
    container.innerHTML = '';

    const today = new Date().getDay(); // 0 = Domingo

    const habitosFiltrados = mostrarTodos 
        ? data.habits 
        : data.habits.filter(h => 
            h.frequency === 'daily' || 
            (h.frequency === 'custom' && h.days && h.days.includes(today))
        );

    habitosFiltrados.forEach(habit => {
        const card = createHabitCard(habit);
        container.appendChild(card);
    });
}
window.onload = () => {
    renderHabits();
};
const diasAsignados = [];
function descargarRespaldo() {
  const exportData = {
    habits: data.habits,
    incomes: data.incomes,
    expenses: data.expenses,
    media: data.media,
    books: data.books,
    courses: data.courses,
    journal: data.journal,
    achievements: data.achievements,
    settings: data.settings,
    customCategories: data.customCategories
  };

  const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'respaldo_mi_tracker.json';
  a.click();
}

function descargarDatos() {
  descargarRespaldo(); // misma funci√≥n
}

console.log("H√ÅBITOS REGISTRADOS:", data.habits);

    </script>

<script>
  document.querySelectorAll('.calendar-day.current-month').forEach(day => {
    day.addEventListener('click', () => {
      if (!day.classList.contains('disabled') && !day.classList.contains('header')) {
        day.classList.toggle('completed');
      }
    });
  });
</script>


<script>
  // Clave de almacenamiento
  const HABIT_STORAGE_KEY = 'habitCompletions';

  // Cargar datos guardados
  const savedCompletions = JSON.parse(localStorage.getItem(HABIT_STORAGE_KEY)) || {};

  // Aplicar estado guardado al cargar la p√°gina
  document.querySelectorAll('.calendar-day.current-month').forEach(day => {
    const date = day.dataset.date;
    const habitId = day.closest('.habit-card')?.dataset.id;
    if (habitId && date && savedCompletions[habitId]?.includes(date)) {
      day.classList.add('completed');
    }

    // A√±adir evento de clic para marcar/demarcar
    day.addEventListener('click', () => {
      if (day.classList.contains('disabled') || day.classList.contains('header')) return;
      day.classList.toggle('completed');

      const date = day.dataset.date;
      const habitId = day.closest('.habit-card')?.dataset.id;
      if (!habitId || !date) return;

      if (!savedCompletions[habitId]) {
        savedCompletions[habitId] = [];
      }

      if (day.classList.contains('completed')) {
        if (!savedCompletions[habitId].includes(date)) {
          savedCompletions[habitId].push(date);
        }
      } else {
        savedCompletions[habitId] = savedCompletions[habitId].filter(d => d !== date);
      }

      localStorage.setItem(HABIT_STORAGE_KEY, JSON.stringify(savedCompletions));
    });
  });
  renderMediaGenreChart();
</script>




<script>
function generarGraficoGeneroMedia() {
    const conteoPorGenero = {};
    const colores = {};

    // Colores √∫nicos por g√©nero, extendido si hay muchos
    const paleta = [
        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
        '#9966FF', '#FF9F40', '#66BB6A', '#BA68C8',
        '#F06292', '#9575CD', '#26C6DA', '#D4E157',
        '#EC407A', '#5C6BC0', '#9CCC65', '#FFA726',
        '#AB47BC', '#26A69A', '#EF5350', '#42A5F5'
    ];

    let colorIndex = 0;

    // Recolectar y contar por g√©nero
    data.media.forEach(item => {
        const genero = item.genre ? item.genre.trim().toUpperCase() : 'SIN G√âNERO';
        if (!conteoPorGenero[genero]) {
            conteoPorGenero[genero] = 0;
            colores[genero] = paleta[colorIndex % paleta.length];
            colorIndex++;
        }
        conteoPorGenero[genero]++;
    });

    const labels = Object.keys(conteoPorGenero);
    const cantidades = Object.values(conteoPorGenero);
    const coloresFinales = labels.map(g => colores[g]);

    const ctx = document.getElementById('mediaGenreChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Cantidad',
                data: cantidades,
                backgroundColor: coloresFinales,
                borderColor: '#000',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// Aseguramos que se llame cuando se cargue la p√°gina
window.onload = function () {
    if (typeof generarGraficoGeneroMedia === 'function') generarGraficoGeneroMedia();
};
</script>

</body>
</html>
