<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Tracker Personal</title>
    <link rel="icon" type="image/png" href="./icon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 50%, #1a1a1a 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #dc3545, #000000);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab-btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: 2px solid #87ceeb;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tab-btn:hover {
            background: linear-gradient(135deg, #87ceeb, #5f9ea0);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(135, 206, 235, 0.4);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #87ceeb, #5f9ea0);
            color: #000;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(135, 206, 235, 0.4);
        }

        .tab-content {
            display: none;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px solid #6c757d;
            color: #212529;
        }

        .tab-content.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title {
            font-size: 1.8rem;
            color: #dc3545;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 2px solid transparent;
        }

        .btn:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #87ceeb, #5f9ea0);
            color: #000;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #5f9ea0, #4682b4);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #495057, #343a40);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #212529;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #6c757d;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
            color: #212529;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #87ceeb;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.2);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Days selector styles */
        .days-selector {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .day-checkbox {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border: 2px solid #6c757d;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .day-checkbox:hover {
            border-color: #87ceeb;
            background: #f8f9fa;
        }

        .day-checkbox.selected {
            border-color: #87ceeb;
            background: linear-gradient(135deg, #87ceeb, #5f9ea0);
            color: white;
        }

        .day-checkbox input {
            display: none;
        }

        .day-checkbox .day-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .day-checkbox .day-initial {
            font-size: 10px;
            opacity: 0.8;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 2px solid #6c757d;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #dc3545;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #a71e2a;
        }

        .items-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #dc3545;
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-left-color: #87ceeb;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .item-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #212529;
            margin: 0;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #212529, #495057);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #87ceeb;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #87ceeb;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Habits Grid - 2 columns */
        .habits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* Habit Calendar Styles - Más compacto */
        .habit-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 10px;
            padding: 12px;
            border-left: 4px solid #dc3545;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .habit-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 10px;
        }

        .habit-info h3 {
            margin: 0;
            color: #212529;
            font-size: 1rem;
        }

        .habit-info p {
            margin: 2px 0;
            color: #6c757d;
            font-size: 12px;
        }

        .habit-days {
            display: flex;
            gap: 3px;
            margin: 5px 0;
            flex-wrap: wrap;
        }

        .habit-day-tag {
            background: linear-gradient(135deg, #87ceeb, #5f9ea0);
            color: #000;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
        }

        .habit-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            margin-top: 8px;
            max-width: 220px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
            font-size: 9px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            min-height: 20px;
        }

        .calendar-day.header {
            background: linear-gradient(135deg, #212529, #495057);
            color: #87ceeb;
            cursor: default;
            font-size: 8px;
        }

        .calendar-day.empty {
            cursor: default;
        }

        .calendar-day.current-month {
            background: #e9ecef;
            color: #212529;
            border-color: #dee2e6;
        }

        .calendar-day.current-month:hover {
            background: #dee2e6;
            border-color: #87ceeb;
        }

        .calendar-day.completed {
            background: linear-gradient(135deg, #87ceeb, #5f9ea0);
            color: #000;
            font-weight: bold;
        }

        .calendar-day.today {
            border-color: #dc3545;
            border-width: 2px;
            font-weight: bold;
        }

        .calendar-day.disabled {
            background: #f8f9fa;
            color: #adb5bd;
            cursor: not-allowed;
        }

        .calendar-day.available {
            background: #e9ecef;
            color: #212529;
            border-color: #dee2e6;
        }

        .habit-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            font-size: 11px;
            color: #6c757d;
            flex-wrap: wrap;
            gap: 3px;
        }

        /* Finance Section Styles */
        .finance-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .finance-tab {
            background: linear-gradient(135deg, #6c757d, #495057);
            border: 2px solid #87ceeb;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-weight: 500;
        }

        .finance-tab.active {
            background: linear-gradient(135deg, #87ceeb, #5f9ea0);
            color: #000;
            font-weight: bold;
        }

        .finance-summary {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .balance-card {
            background: linear-gradient(135deg, #212529, #495057);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid #87ceeb;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .balance-amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #87ceeb;
        }

        .income-card {
            border-left-color: #87ceeb;
        }

        .expense-card {
            border-left-color: #dc3545;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }

        .progress-fill {
            background: linear-gradient(135deg, #87ceeb, #5f9ea0);
            height: 100%;
            transition: width 0.3s ease;
        }

        .rating {
            display: flex;
            gap: 5px;
        }

        .star {
            font-size: 20px;
            color: #dee2e6;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .star.filled {
            color: #ffd700;
        }

        .tag {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-block;
            margin: 2px;
            border: 1px solid #87ceeb;
        }

        .download-section {
            background: linear-gradient(135deg, #212529, #495057);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #87ceeb;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .download-section h3 {
            color: #87ceeb;
            margin-bottom: 15px;
        }

        .download-section p {
            color: #e9ecef;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .download-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .habits-grid {
                grid-template-columns: 1fr;
            }

            .habit-calendar {
                max-width: 100%;
                grid-template-columns: repeat(7, 1fr);
                gap: 1px;
            }

            .calendar-day {
                font-size: 8px;
                min-height: 18px;
            }

            .habit-stats {
                font-size: 10px;
            }

            .download-buttons {
                flex-direction: column;
                align-items: center;
            }

            .days-selector {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Mi Tracker Personal</h1>
            <p>Organiza tu vida, alcanza tus metas</p>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="downloadMonthlyReport()">📥 Descargar Reporte</button>
                <button class="btn btn-secondary" onclick="openModal('uploadModal')">📤 Cargar Datos</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">📊 Dashboard</button>
            <button class="tab-btn" onclick="showTab('habits')">✅ Hábitos</button>
            <button class="tab-btn" onclick="showTab('finances')">💰 Finanzas</button>
            <button class="tab-btn" onclick="showTab('media')">🎬 Películas/Series</button>
            <button class="tab-btn" onclick="showTab('books')">📚 Libros</button>
            <button class="tab-btn" onclick="showTab('courses')">🎓 Cursos</button>
            <button class="tab-btn" onclick="showTab('journal')">📝 Journal</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2 class="section-title">📊 Dashboard General</h2>
            
            <div class="download-section">
                <h3>📄 Reporte Mensual</h3>
                <p>Descarga un reporte detallado de tu progreso del mes actual</p>
                <div class="download-buttons">
                    <button class="btn btn-success" onclick="downloadMonthlyReport()">📥 Descargar Reporte</button>
                    <button class="btn btn-secondary" onclick="openModal('uploadModal')">📤 Cargar Respaldo</button>
                </div>
            </div>

            <div class="stats-grid" id="statsGrid">
                <!-- Stats will be populated by JavaScript -->
            </div>
            <div id="recentActivity">
                <h3>📈 Actividad Reciente</h3>
                <div id="recentItems"></div>
            </div>
        </div>

        <!-- Habits Tab -->
        <div id="habits" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">✅ Mis Hábitos</h2>
                <button class="btn" onclick="openModal('habitModal')">+ Nuevo Hábito</button>
            </div>
            <div class="habits-grid" id="habitsList">
                <!-- Habits will be populated by JavaScript -->
            </div>
        </div>

        <!-- Finances Tab -->
        <div id="finances" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">💰 Mis Finanzas</h2>
                <div>
                    <button class="btn btn-success" onclick="openModal('incomeModal')">+ Nuevo Ingreso</button>
                    <button class="btn" onclick="openModal('expenseModal')">+ Nuevo Gasto</button>
                </div>
            </div>
            
            <div class="balance-card" id="balanceCard">
                <div class="balance-amount" id="balanceAmount">$0.00</div>
                <div>Balance Total</div>
            </div>

            <div class="finance-tabs">
                <div class="finance-tab active" onclick="showFinanceTab('summary')">📊 Resumen</div>
                <div class="finance-tab" onclick="showFinanceTab('incomes')">💚 Ingresos</div>
                <div class="finance-tab" onclick="showFinanceTab('expenses')">💸 Gastos</div>
            </div>

            <div id="financeSummary" class="finance-content active">
                <div id="monthlyFinanceSummary"></div>
            </div>

            <div id="financeIncomes" class="finance-content">
                <div class="items-grid" id="incomesList"></div>
            </div>

            <div id="financeExpenses" class="finance-content">
                <div class="items-grid" id="expensesList"></div>
            </div>
        </div>

        <!-- Media Tab -->
        <div id="media" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">🎬 Películas y Series</h2>
                <button class="btn" onclick="openModal('mediaModal')">+ Agregar Película/Serie</button>
            </div>
            <div class="items-grid" id="mediaList">
                <!-- Media will be populated by JavaScript -->
            </div>
        </div>

        <!-- Books Tab -->
        <div id="books" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">📚 Mis Libros</h2>
                <button class="btn" onclick="openModal('bookModal')">+ Nuevo Libro</button>
            </div>
            <div class="items-grid" id="booksList">
                <!-- Books will be populated by JavaScript -->
            </div>
        </div>

        <!-- Courses Tab -->
        <div id="courses" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">🎓 Mis Cursos</h2>
                <button class="btn" onclick="openModal('courseModal')">+ Nuevo Curso</button>
            </div>
            <div class="items-grid" id="coursesList">
                <!-- Courses will be populated by JavaScript -->
            </div>
        </div>

        <!-- Journal Tab -->
        <div id="journal" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">📝 Mi Journal</h2>
                <button class="btn" onclick="openModal('journalModal')">+ Nueva Entrada</button>
            </div>
            <div class="items-grid" id="journalList">
                <!-- Journal entries will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('uploadModal')">&times;</span>
            <h2>📤 Cargar Respaldo de Datos</h2>
            <div class="form-group">
                <label for="fileInput">Selecciona tu archivo de respaldo (.json):</label>
                <input type="file" id="fileInput" accept=".json" onchange="loadDataFromFile(event)">
            </div>
            <p style="color: #6c757d; font-size: 14px; margin-top: 10px;">
                ⚠️ Esto reemplazará todos tus datos actuales con los del archivo de respaldo.
            </p>
        </div>
    </div>

    <!-- Habit Modal -->
    <div id="habitModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('habitModal')">&times;</span>
            <h2>✅ Nuevo Hábito</h2>
            <form id="habitForm">
                <div class="form-group">
                    <label for="habitName">Nombre del Hábito:</label>
                    <input type="text" id="habitName" required>
                </div>
                <div class="form-group">
                    <label for="habitDescription">Descripción:</label>
                    <textarea id="habitDescription"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="habitFrequency">Frecuencia:</label>
                        <select id="habitFrequency">
                            <option value="daily">Diario</option>
                            <option value="weekly">Semanal</option>
                            <option value="custom">Días específicos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="habitCategory">Categoría:</label>
                        <select id="habitCategory">
                            <option value="limpieza">Limpieza</option>
                            <option value="fisico">Físico</option>
                            <option value="conocimiento">Conocimiento</option>
                            <option value="habito">Hábito</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                </div>
                <div class="form-group" id="daysSelector" style="display: none;">
                    <label>Días de la semana:</label>
                    <div class="days-selector">
                        <div class="day-checkbox" onclick="toggleDay(this, 0)">
                            <input type="checkbox" value="0">
                            <span class="day-name">Dom</span>
                            <span class="day-initial">D</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 1)">
                            <input type="checkbox" value="1">
                            <span class="day-name">Lun</span>
                            <span class="day-initial">L</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 2)">
                            <input type="checkbox" value="2">
                            <span class="day-name">Mar</span>
                            <span class="day-initial">M</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 3)">
                            <input type="checkbox" value="3">
                            <span class="day-name">Mié</span>
                            <span class="day-initial">M</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 4)">
                            <input type="checkbox" value="4">
                            <span class="day-name">Jue</span>
                            <span class="day-initial">J</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 5)">
                            <input type="checkbox" value="5">
                            <span class="day-name">Vie</span>
                            <span class="day-initial">V</span>
                        </div>
                        <div class="day-checkbox" onclick="toggleDay(this, 6)">
                            <input type="checkbox" value="6">
                            <span class="day-name">Sáb</span>
                            <span class="day-initial">S</span>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn">Guardar Hábito</button>
            </form>
        </div>
    </div>

    <!-- Income Modal -->
    <div id="incomeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('incomeModal')">&times;</span>
            <h2>💚 Nuevo Ingreso</h2>
            <form id="incomeForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="incomeAmount">Monto:</label>
                        <input type="number" id="incomeAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="incomeDate">Fecha:</label>
                        <input type="date" id="incomeDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="incomeDescription">Descripción:</label>
                    <input type="text" id="incomeDescription" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="incomeCategory">Categoría:</label>
                        <select id="incomeCategory">
                            <option value="salario">Salario</option>
                            <option value="freelance">Freelance</option>
                            <option value="inversion">Inversión</option>
                            <option value="regalo">Regalo</option>
                            <option value="venta">Venta</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="incomeRecurring">¿Es recurrente?</label>
                        <select id="incomeRecurring">
                            <option value="no">No</option>
                            <option value="mensual">Mensual</option>
                            <option value="quincenal">Quincenal</option>
                            <option value="semanal">Semanal</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">Guardar Ingreso</button>
            </form>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('expenseModal')">&times;</span>
            <h2>💸 Nuevo Gasto</h2>
            <form id="expenseForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="expenseAmount">Monto:</label>
                        <input type="number" id="expenseAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseDate">Fecha:</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="expenseDescription">Descripción:</label>
                    <input type="text" id="expenseDescription" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="expenseCategory">Categoría:</label>
                        <select id="expenseCategory">
                            <option value="comida">Comida</option>
                            <option value="transporte">Transporte</option>
                            <option value="entretenimiento">Entretenimiento</option>
                            <option value="salud">Salud</option>
                            <option value="educacion">Educación</option>
                            <option value="servicios">Servicios</option>
                            <option value="ropa">Ropa</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expensePayment">Método de Pago:</label>
                        <select id="expensePayment">
                            <option value="efectivo">Efectivo</option>
                            <option value="tarjeta">Tarjeta</option>
                            <option value="transferencia">Transferencia</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">Guardar Gasto</button>
            </form>
        </div>
    </div>

    <!-- Media Modal -->
    <div id="mediaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('mediaModal')">&times;</span>
            <h2>🎬 Nueva Película/Serie</h2>
            <form id="mediaForm">
                <div class="form-group">
                    <label for="mediaTitle">Título:</label>
                    <input type="text" id="mediaTitle" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mediaType">Tipo:</label>
                        <select id="mediaType">
                            <option value="pelicula">Película</option>
                            <option value="serie">Serie</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mediaYear">Año:</label>
                        <input type="number" id="mediaYear" min="1900" max="2030">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mediaGenre">Género:</label>
                        <input type="text" id="mediaGenre">
                    </div>
                    <div class="form-group">
                        <label for="mediaPlatform">Plataforma:</label>
                        <input type="text" id="mediaPlatform">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mediaStatus">Estado:</label>
                        <select id="mediaStatus">
                            <option value="viendo">Viendo</option>
                            <option value="completada">Completada</option>
                            <option value="pausada">Pausada</option>
                            <option value="abandonada">Abandonada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mediaRating">Calificación (1-10):</label>
                        <input type="number" id="mediaRating" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="mediaReview">Reseña:</label>
                    <textarea id="mediaReview"></textarea>
                </div>
                <button type="submit" class="btn">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Book Modal -->
    <div id="bookModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('bookModal')">&times;</span>
            <h2>📚 Nuevo Libro</h2>
            <form id="bookForm">
                <div class="form-group">
                    <label for="bookTitle">Título:</label>
                    <input type="text" id="bookTitle" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookAuthor">Autor:</label>
                        <input type="text" id="bookAuthor" required>
                    </div>
                    <div class="form-group">
                        <label for="bookPages">Páginas:</label>
                        <input type="number" id="bookPages" min="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookGenre">Género:</label>
                        <input type="text" id="bookGenre">
                    </div>
                    <div class="form-group">
                        <label for="bookFormat">Formato:</label>
                        <select id="bookFormat">
                            <option value="fisico">Físico</option>
                            <option value="digital">Digital</option>
                            <option value="audiolibro">Audiolibro</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookStatus">Estado:</label>
                        <select id="bookStatus">
                            <option value="leyendo">Leyendo</option>
                            <option value="terminado">Terminado</option>
                            <option value="pausado">Pausado</option>
                            <option value="abandonado">Abandonado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bookRating">Calificación (1-10):</label>
                        <input type="number" id="bookRating" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="bookNotes">Notas:</label>
                    <textarea id="bookNotes"></textarea>
                </div>
                <button type="submit" class="btn">Guardar Libro</button>
            </form>
        </div>
    </div>

    <!-- Course Modal -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('courseModal')">&times;</span>
            <h2>🎓 Nuevo Curso</h2>
            <form id="courseForm">
                <div class="form-group">
                    <label for="courseName">Nombre del Curso:</label>
                    <input type="text" id="courseName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseInstructor">Instructor:</label>
                        <input type="text" id="courseInstructor">
                    </div>
                    <div class="form-group">
                        <label for="coursePlatform">Plataforma:</label>
                        <input type="text" id="coursePlatform">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseDuration">Duración (horas):</label>
                        <input type="number" id="courseDuration" min="1">
                    </div>
                    <div class="form-group">
                        <label for="courseProgress">Progreso (%):</label>
                        <input type="number" id="courseProgress" min="0" max="100" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseStatus">Estado:</label>
                        <select id="courseStatus">
                            <option value="activo">Activo</option>
                            <option value="completado">Completado</option>
                            <option value="pausado">Pausado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="courseRating">Calificación (1-10):</label>
                        <input type="number" id="courseRating" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="courseSkills">Habilidades Aprendidas:</label>
                    <textarea id="courseSkills"></textarea>
                </div>
                <button type="submit" class="btn">Guardar Curso</button>
            </form>
        </div>
    </div>

    <!-- Journal Modal -->
    <div id="journalModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('journalModal')">&times;</span>
            <h2>📝 Nueva Entrada de Journal</h2>
            <form id="journalForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="journalDate">Fecha:</label>
                        <input type="date" id="journalDate" required>
                    </div>
                    <div class="form-group">
                        <label for="journalMood">Estado de Ánimo:</label>
                        <select id="journalMood">
                            <option value="😄">😄 Excelente</option>
                            <option value="😊">😊 Bien</option>
                            <option value="😐">😐 Normal</option>
                            <option value="😔">😔 Triste</option>
                            <option value="😠">😠 Enojado</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="journalTitle">Título del Día:</label>
                    <input type="text" id="journalTitle">
                </div>
                <div class="form-group">
                    <label for="journalContent">Reflexiones del Día:</label>
                    <textarea id="journalContent" required></textarea>
                </div>
                <div class="form-group">
                    <label for="journalGratitude">3 Cosas por las que estoy agradecido:</label>
                    <textarea id="journalGratitude"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="journalEnergy">Nivel de Energía (1-10):</label>
                        <input type="number" id="journalEnergy" min="1" max="10" value="5">
                    </div>
                    <div class="form-group">
                        <label for="journalSleep">Calidad del Sueño (1-10):</label>
                        <input type="number" id="journalSleep" min="1" max="10" value="5">
                    </div>
                </div>
                <button type="submit" class="btn">Guardar Entrada</button>
            </form>
        </div>
    </div>

    <script>
        // Data storage
        let data = {
            habits: JSON.parse(localStorage.getItem('habits')) || [],
            incomes: JSON.parse(localStorage.getItem('incomes')) || [],
            expenses: JSON.parse(localStorage.getItem('expenses')) || [],
            media: JSON.parse(localStorage.getItem('media')) || [],
            books: JSON.parse(localStorage.getItem('books')) || [],
            courses: JSON.parse(localStorage.getItem('courses')) || [],
            journal: JSON.parse(localStorage.getItem('journal')) || []
        };

        // Save data to localStorage
        function saveData(type) {
            localStorage.setItem(type, JSON.stringify(data[type]));
        }

        // Get month name in Spanish
        function getMonthName(monthIndex) {
            const months = [
                'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
                'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
            ];
            return months[monthIndex];
        }

        // Generate monthly report
        function generateMonthlyReport() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const monthName = getMonthName(currentMonth);

            let report = `🎯 REPORTE MENSUAL - ${monthName.toUpperCase()} ${currentYear}\n`;
            report += `${'='.repeat(50)}\n\n`;

            // HÁBITOS SECTION
            report += `✅ HÁBITOS\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyHabits = {};
            data.habits.forEach(habit => {
                if (habit.completedDates) {
                    const monthlyCount = habit.completedDates.filter(date => {
                        const d = new Date(date);
                        return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
                    }).length;
                    
                    if (monthlyCount > 0) {
                        monthlyHabits[habit.name] = monthlyCount;
                    }
                }
            });

            if (Object.keys(monthlyHabits).length > 0) {
                report += `Este mes se realizaron estos hábitos:\n\n`;
                Object.entries(monthlyHabits).forEach(([habit, count]) => {
                    report += `• ${habit}: ${count} veces\n`;
                });
                report += `\nTotal de hábitos activos: ${data.habits.length}\n`;
            } else {
                report += `No se registraron hábitos completados este mes.\n`;
            }

            // FINANZAS SECTION
            report += `\n💰 FINANZAS\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyIncomes = data.incomes.filter(income => {
                const incomeDate = new Date(income.date);
                return incomeDate.getMonth() === currentMonth && incomeDate.getFullYear() === currentYear;
            });
            
            const monthlyExpenses = data.expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear;
            });

            const totalIncomes = monthlyIncomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
            const totalExpenses = monthlyExpenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const balance = totalIncomes - totalExpenses;

            report += `Este mes tuviste un movimiento financiero de:\n\n`;
            report += `💚 Ingresos totales: $${totalIncomes.toFixed(2)}\n`;
            report += `💸 Gastos totales: $${totalExpenses.toFixed(2)}\n`;
            report += `📊 Balance del mes: $${balance.toFixed(2)}\n`;
            report += `📈 Transacciones registradas: ${monthlyIncomes.length + monthlyExpenses.length}\n`;

            // ENTRETENIMIENTO SECTION
            report += `\n🎬 ENTRETENIMIENTO\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyMedia = data.media.filter(item => {
                if (item.createdAt) {
                    const createdDate = new Date(item.createdAt);
                    return createdDate.getMonth() === currentMonth && createdDate.getFullYear() === currentYear;
                }
                return false;
            });

            if (monthlyMedia.length > 0) {
                report += `Este mes agregaste ${monthlyMedia.length} nuevas películas/series a tu lista:\n\n`;
                monthlyMedia.forEach(item => {
                    report += `• ${item.title} (${item.type}) - Estado: ${item.status}\n`;
                });
            } else {
                report += `No agregaste nuevas películas o series este mes.\n`;
            }
            report += `\nTotal en tu biblioteca: ${data.media.length} títulos\n`;

            // LIBROS SECTION
            report += `\n📚 LIBROS\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyBooks = data.books.filter(book => {
                if (book.createdAt) {
                    const createdDate = new Date(book.createdAt);
                    return createdDate.getMonth() === currentMonth && createdDate.getFullYear() === currentYear;
                }
                return false;
            });

            if (monthlyBooks.length > 0) {
                report += `Este mes agregaste ${monthlyBooks.length} nuevos libros a tu biblioteca:\n\n`;
                monthlyBooks.forEach(book => {
                    report += `• "${book.title}" por ${book.author} - Estado: ${book.status}\n`;
                });
            } else {
                report += `No agregaste nuevos libros este mes.\n`;
            }
            report += `\nTotal en tu biblioteca: ${data.books.length} libros\n`;

            // CURSOS SECTION
            report += `\n🎓 CURSOS\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyCourses = data.courses.filter(course => {
                if (course.createdAt) {
                    const createdDate = new Date(course.createdAt);
                    return createdDate.getMonth() === currentMonth && createdDate.getFullYear() === currentYear;
                }
                return false;
            });

            if (monthlyCourses.length > 0) {
                report += `Este mes comenzaste ${monthlyCourses.length} nuevos cursos:\n\n`;
                monthlyCourses.forEach(course => {
                    report += `• ${course.name} - Progreso: ${course.progress}% - Estado: ${course.status}\n`;
                });
            } else {
                report += `No comenzaste nuevos cursos este mes.\n`;
            }
            report += `\nTotal de cursos: ${data.courses.length}\n`;

            // JOURNAL SECTION
            report += `\n📝 JOURNAL\n`;
            report += `${'-'.repeat(20)}\n`;
            
            const monthlyJournal = data.journal.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getMonth() === currentMonth && entryDate.getFullYear() === currentYear;
            });

            if (monthlyJournal.length > 0) {
                report += `Este mes escribiste ${monthlyJournal.length} entradas en tu journal:\n\n`;
                
                // Calcular promedios
                const avgEnergy = monthlyJournal.reduce((sum, entry) => sum + parseInt(entry.energy), 0) / monthlyJournal.length;
                const avgSleep = monthlyJournal.reduce((sum, entry) => sum + parseInt(entry.sleep), 0) / monthlyJournal.length;
                
                report += `📊 Estadísticas del mes:\n`;
                report += `• Promedio de energía: ${avgEnergy.toFixed(1)}/10\n`;
                report += `• Promedio de calidad de sueño: ${avgSleep.toFixed(1)}/10\n`;
                report += `• Días registrados: ${monthlyJournal.length}\n`;
            } else {
                report += `No escribiste entradas en tu journal este mes.\n`;
            }
            report += `\nTotal de entradas: ${data.journal.length}\n`;

            // RESUMEN FINAL
            report += `\n🎯 RESUMEN DEL MES\n`;
            report += `${'-'.repeat(20)}\n`;
            report += `• Hábitos completados: ${Object.values(monthlyHabits).reduce((a, b) => a + b, 0)} veces\n`;
            report += `• Balance financiero: $${balance.toFixed(2)}\n`;
            report += `• Nuevo contenido agregado: ${monthlyMedia.length + monthlyBooks.length + monthlyCourses.length} elementos\n`;
            report += `• Entradas de journal: ${monthlyJournal.length}\n`;
            
            report += `\n${'='.repeat(50)}\n`;
            report += `Reporte generado el ${today.toLocaleDateString('es-ES')}\n`;
            report += `¡Sigue así! 🚀\n`;

            return report;
        }

        // Download monthly report as TXT
        function downloadMonthlyReport() {
            const today = new Date();
            const monthName = getMonthName(today.getMonth());
            const year = today.getFullYear();
            
            const reportContent = generateMonthlyReport();
            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${monthName}-${year}.txt`;
            link.click();
            
            alert(`📄 Reporte de ${monthName} ${year} descargado exitosamente!`);
        }

        // Day selector functionality
        function toggleDay(element, dayIndex) {
            const checkbox = element.querySelector('input');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('selected', checkbox.checked);
        }

        // Show/hide days selector based on frequency
        document.getElementById('habitFrequency').addEventListener('change', function() {
            const daysSelector = document.getElementById('daysSelector');
            if (this.value === 'custom') {
                daysSelector.style.display = 'block';
            } else {
                daysSelector.style.display = 'none';
                // Reset all day selections
                document.querySelectorAll('.day-checkbox').forEach(day => {
                    day.classList.remove('selected');
                    day.querySelector('input').checked = false;
                });
            }
        });

        // Load data from file (keeping JSON backup functionality)
        function loadDataFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    const requiredKeys = ['habits', 'incomes', 'expenses', 'media', 'books', 'courses', 'journal'];
                    const hasAllKeys = requiredKeys.every(key => importedData.hasOwnProperty(key));
                    
                    if (!hasAllKeys) {
                        alert('❌ Error: El archivo no tiene el formato correcto.');
                        return;
                    }

                    const confirmReplace = confirm(
                        '⚠️ ¿Estás seguro de que quieres reemplazar todos tus datos actuales?\n\n' +
                        'Esta acción no se puede deshacer. Se recomienda hacer un respaldo de tus datos actuales primero.'
                    );

                    if (confirmReplace) {
                        data.habits = importedData.habits || [];
                        data.incomes = importedData.incomes || [];
                        data.expenses = importedData.expenses || [];
                        data.media = importedData.media || [];
                        data.books = importedData.books || [];
                        data.courses = importedData.courses || [];
                        data.journal = importedData.journal || [];

                        Object.keys(data).forEach(key => {
                            localStorage.setItem(key, JSON.stringify(data[key]));
                        });

                        closeModal('uploadModal');
                        loadDashboard();
                        
                        alert('✅ Datos cargados exitosamente!\n\nTodos tus datos han sido restaurados desde el archivo de respaldo.');
                    }
                } catch (error) {
                    alert('❌ Error al leer el archivo: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Tab functionality
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') loadDashboard();
            else if (tabName === 'habits') loadHabits();
            else if (tabName === 'finances') loadFinances();
            else if (tabName === 'media') loadMedia();
            else if (tabName === 'books') loadBooks();
            else if (tabName === 'courses') loadCourses();
            else if (tabName === 'journal') loadJournal();
        }

        // Finance tab functionality
        function showFinanceTab(tabName) {
            document.querySelectorAll('.finance-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.finance-content').forEach(content => {
                content.style.display = 'none';
            });

            event.target.classList.add('active');
            
            if (tabName === 'summary') {
                document.getElementById('financeSummary').style.display = 'block';
                loadFinanceSummary();
            } else if (tabName === 'incomes') {
                document.getElementById('financeIncomes').style.display = 'block';
                loadIncomes();
            } else if (tabName === 'expenses') {
                document.getElementById('financeExpenses').style.display = 'block';
                loadExpenses();
            }
        }

        // Modal functionality
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll(`#${modalId} input[type="date"]`);
            dateInputs.forEach(input => {
                if (!input.value) input.value = today;
            });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
            
            // Reset day selector
            if (modalId === 'habitModal') {
                document.getElementById('daysSelector').style.display = 'none';
                document.querySelectorAll('.day-checkbox').forEach(day => {
                    day.classList.remove('selected');
                    day.querySelector('input').checked = false;
                });
            }
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Dashboard functions
        function loadDashboard() {
            const statsGrid = document.getElementById('statsGrid');
            const totalHabits = data.habits.length;
            const totalIncomes = data.incomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
            const totalExpenses = data.expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const balance = totalIncomes - totalExpenses;
            const totalMedia = data.media.length;
            const totalBooks = data.books.length;
            const totalCourses = data.courses.length;
            const totalJournalEntries = data.journal.length;

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalHabits}</div>
                    <div class="stat-label">Hábitos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">$${balance.toFixed(2)}</div>
                    <div class="stat-label">Balance</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalMedia}</div>
                    <div class="stat-label">Películas/Series</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalBooks}</div>
                    <div class="stat-label">Libros</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalCourses}</div>
                    <div class="stat-label">Cursos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalJournalEntries}</div>
                    <div class="stat-label">Entradas de Journal</div>
                </div>
            `;
        }

        // Calendar functions for habits
        function generateCalendar(year, month, habitId) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
            const todayDate = today.getDate();

            const habit = data.habits.find(h => h.id === habitId);
            const allowedDays = habit.allowedDays || [];

            let calendar = '';
            
            // Headers
            const dayHeaders = ['D', 'L', 'M', 'M', 'J', 'V', 'S'];
            dayHeaders.forEach(day => {
                calendar += `<div class="calendar-day header">${day}</div>`;
            });

            // Empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                calendar += '<div class="calendar-day empty"></div>';
            }

            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayOfWeek = new Date(year, month, day).getDay();
                const isCompleted = habit && habit.completedDates && habit.completedDates.includes(dateStr);
                const isToday = isCurrentMonth && day === todayDate;
                const isAllowed = allowedDays.length === 0 || allowedDays.includes(dayOfWeek);
                
                let classes = 'calendar-day current-month';
                if (isCompleted) classes += ' completed';
                if (isToday) classes += ' today';
                if (!isAllowed) classes += ' disabled';
                else classes += ' available';
                
                const clickHandler = isAllowed ? `onclick="toggleHabitDay('${habitId}', '${dateStr}')"` : '';
                
                calendar += `<div class="${classes}" ${clickHandler}>${day}</div>`;
            }

            return calendar;
        }

        function toggleHabitDay(habitId, dateStr) {
            const habitIndex = data.habits.findIndex(h => h.id === habitId);
            if (habitIndex === -1) return;

            if (!data.habits[habitIndex].completedDates) {
                data.habits[habitIndex].completedDates = [];
            }

            const dateIndex = data.habits[habitIndex].completedDates.indexOf(dateStr);
            if (dateIndex > -1) {
                data.habits[habitIndex].completedDates.splice(dateIndex, 1);
            } else {
                data.habits[habitIndex].completedDates.push(dateStr);
            }

            saveData('habits');
            loadHabits();
        }

        function getHabitStats(habit) {
            if (!habit.completedDates) return { streak: 0, thisMonth: 0, total: 0 };

            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            const thisMonth = habit.completedDates.filter(date => {
                const d = new Date(date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).length;

            let streak = 0;
            const sortedDates = habit.completedDates.sort().reverse();
            let checkDate = new Date(today);
            
            for (const dateStr of sortedDates) {
                const date = new Date(dateStr);
                const diffTime = checkDate - date;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0 || diffDays === 1) {
                    streak++;
                    checkDate = date;
                } else {
                    break;
                }
            }

            return {
                streak,
                thisMonth,
                total: habit.completedDates.length
            };
        }

        function getDayNames(allowedDays) {
            const dayNames = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            return allowedDays.map(day => dayNames[day]);
        }

        // Habits functions
        function loadHabits() {
            const habitsList = document.getElementById('habitsList');
            habitsList.innerHTML = '';

            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();

            data.habits.forEach((habit, index) => {
                const stats = getHabitStats(habit);
                const calendar = generateCalendar(currentYear, currentMonth, habit.id);
                
                let daysDisplay = '';
                if (habit.frequency === 'custom' && habit.allowedDays && habit.allowedDays.length > 0) {
                    const dayNames = getDayNames(habit.allowedDays);
                    daysDisplay = `<div class="habit-days">
                        ${dayNames.map(day => `<span class="habit-day-tag">${day}</span>`).join('')}
                    </div>`;
                }
                
                const habitElement = document.createElement('div');
                habitElement.className = 'habit-card';
                habitElement.innerHTML = `
                    <div class="habit-header">
                        <div class="habit-info">
                            <h3>${habit.name}</h3>
                            <p>${habit.description}</p>
                            <div>
                                <span class="tag">${habit.category}</span>
                                <span class="tag">${habit.frequency === 'custom' ? 'Personalizado' : habit.frequency}</span>
                            </div>
                            ${daysDisplay}
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteHabit(${index})">Eliminar</button>
                        </div>
                    </div>
                    <div class="habit-stats">
                        <span><strong>Racha:</strong> ${stats.streak}d</span>
                        <span><strong>Este mes:</strong> ${stats.thisMonth}d</span>
                        <span><strong>Total:</strong> ${stats.total}d</span>
                    </div>
                    <div class="habit-calendar">
                        ${calendar}
                    </div>
                `;
                habitsList.appendChild(habitElement);
            });
        }

        function deleteHabit(index) {
            if (confirm('¿Estás seguro de que quieres eliminar este hábito?')) {
                data.habits.splice(index, 1);
                saveData('habits');
                loadHabits();
            }
        }

        // Finance functions
        function loadFinances() {
            updateBalance();
            loadFinanceSummary();
        }

        function updateBalance() {
            const totalIncomes = data.incomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
            const totalExpenses = data.expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const balance = totalIncomes - totalExpenses;
            
            const balanceAmount = document.getElementById('balanceAmount');
            balanceAmount.textContent = `$${balance.toFixed(2)}`;
        }

        function loadFinanceSummary() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyIncomes = data.incomes.filter(income => {
                const incomeDate = new Date(income.date);
                return incomeDate.getMonth() === currentMonth && incomeDate.getFullYear() === currentYear;
            });
            
            const monthlyExpenses = data.expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear;
            });

            const monthlyIncomeTotal = monthlyIncomes.reduce((sum, income) => sum + parseFloat(income.amount), 0);
            const monthlyExpenseTotal = monthlyExpenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const monthlyBalance = monthlyIncomeTotal - monthlyExpenseTotal;

            // Group by category
            const incomeCategories = {};
            const expenseCategories = {};
            
            monthlyIncomes.forEach(income => {
                incomeCategories[income.category] = (incomeCategories[income.category] || 0) + parseFloat(income.amount);
            });
            
            monthlyExpenses.forEach(expense => {
                expenseCategories[expense.category] = (expenseCategories[expense.category] || 0) + parseFloat(expense.amount);
            });

            const financeSummary = document.getElementById('monthlyFinanceSummary');
            financeSummary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="stat-card" style="background: linear-gradient(135deg, #87ceeb, #5f9ea0); color: #000;">
                        <div class="stat-number">$${monthlyIncomeTotal.toFixed(2)}</div>
                        <div class="stat-label">Ingresos del Mes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #dc3545, #c82333);">
                        <div class="stat-number">$${monthlyExpenseTotal.toFixed(2)}</div>
                        <div class="stat-label">Gastos del Mes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, ${monthlyBalance >= 0 ? '#6c757d, #495057' : '#dc3545, #c82333'});">
                        <div class="stat-number">$${monthlyBalance.toFixed(2)}</div>
                        <div class="stat-label">Balance del Mes</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: linear-gradient(135deg, #ffffff, #f8f9fa); padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4 style="color: #87ceeb; margin-bottom: 15px;">💚 Ingresos por Categoría</h4>
                        ${Object.entries(incomeCategories).map(([category, total]) => 
                            `<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>${category}:</span>
                                <strong>$${total.toFixed(2)}</strong>
                            </div>`
                        ).join('') || '<p>No hay ingresos este mes</p>'}
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #ffffff, #f8f9fa); padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4 style="color: #dc3545; margin-bottom: 15px;">💸 Gastos por Categoría</h4>
                        ${Object.entries(expenseCategories).map(([category, total]) => 
                            `<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>${category}:</span>
                                <strong>$${total.toFixed(2)}</strong>
                            </div>`
                        ).join('') || '<p>No hay gastos este mes</p>'}
                    </div>
                </div>
            `;
        }

        function loadIncomes() {
            const incomesList = document.getElementById('incomesList');
            incomesList.innerHTML = '';

            data.incomes.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((income, index) => {
                const incomeElement = document.createElement('div');
                incomeElement.className = 'item-card income-card';
                incomeElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">+$${parseFloat(income.amount).toFixed(2)} - ${income.description}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteIncome(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Fecha:</strong> ${income.date}</p>
                    <p><strong>Categoría:</strong> ${income.category}</p>
                    <p><strong>Recurrente:</strong> ${income.recurring}</p>
                `;
                incomesList.appendChild(incomeElement);
            });
        }

        function loadExpenses() {
            const expensesList = document.getElementById('expensesList');
            expensesList.innerHTML = '';

            data.expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((expense, index) => {
                const expenseElement = document.createElement('div');
                expenseElement.className = 'item-card expense-card';
                expenseElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">-$${parseFloat(expense.amount).toFixed(2)} - ${expense.description}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteExpense(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Fecha:</strong> ${expense.date}</p>
                    <p><strong>Categoría:</strong> ${expense.category}</p>
                    <p><strong>Método de Pago:</strong> ${expense.payment}</p>
                `;
                expensesList.appendChild(expenseElement);
            });
        }

        function deleteIncome(index) {
            if (confirm('¿Estás seguro de que quieres eliminar este ingreso?')) {
                data.incomes.splice(index, 1);
                saveData('incomes');
                updateBalance();
                loadIncomes();
                loadFinanceSummary();
            }
        }

        function deleteExpense(index) {
            if (confirm('¿Estás seguro de que quieres eliminar este gasto?')) {
                data.expenses.splice(index, 1);
                saveData('expenses');
                updateBalance();
                loadExpenses();
                loadFinanceSummary();
            }
        }

        // Media functions
        function loadMedia() {
            const mediaList = document.getElementById('mediaList');
            mediaList.innerHTML = '';

            data.media.forEach((item, index) => {
                const mediaElement = document.createElement('div');
                mediaElement.className = 'item-card';
                mediaElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">${item.title} (${item.year})</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteMedia(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Tipo:</strong> ${item.type}</p>
                    <p><strong>Género:</strong> ${item.genre}</p>
                    <p><strong>Plataforma:</strong> ${item.platform}</p>
                    <p><strong>Estado:</strong> ${item.status}</p>
                    ${item.rating ? `<p><strong>Calificación:</strong> ${item.rating}/10</p>` : ''}
                    ${item.review ? `<p><strong>Reseña:</strong> ${item.review}</p>` : ''}
                `;
                mediaList.appendChild(mediaElement);
            });
        }

        function deleteMedia(index) {
            if (confirm('¿Estás seguro de que quieres eliminar este elemento?')) {
                data.media.splice(index, 1);
                saveData('media');
                loadMedia();
            }
        }

        // Books functions
        function loadBooks() {
            const booksList = document.getElementById('booksList');
            booksList.innerHTML = '';

            data.books.forEach((book, index) => {
                const bookElement = document.createElement('div');
                bookElement.className = 'item-card';
                bookElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">${book.title}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteBook(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Autor:</strong> ${book.author}</p>
                    <p><strong>Páginas:</strong> ${book.pages}</p>
                    <p><strong>Género:</strong> ${book.genre}</p>
                    <p><strong>Formato:</strong> ${book.format}</p>
                    <p><strong>Estado:</strong> ${book.status}</p>
                    ${book.rating ? `<p><strong>Calificación:</strong> ${book.rating}/10</p>` : ''}
                    ${book.notes ? `<p><strong>Notas:</strong> ${book.notes}</p>` : ''}
                `;
                booksList.appendChild(bookElement);
            });
        }

        function deleteBook(index) {
            if (confirm('¿Estás seguro de que quieres eliminar este libro?')) {
                data.books.splice(index, 1);
                saveData('books');
                loadBooks();
            }
        }

        // Courses functions
        function loadCourses() {
            const coursesList = document.getElementById('coursesList');
            coursesList.innerHTML = '';

            data.courses.forEach((course, index) => {
                const courseElement = document.createElement('div');
                courseElement.className = 'item-card';
                courseElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">${course.name}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteCourse(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Instructor:</strong> ${course.instructor}</p>
                    <p><strong>Plataforma:</strong> ${course.platform}</p>
                    <p><strong>Duración:</strong> ${course.duration} horas</p>
                    <p><strong>Estado:</strong> ${course.status}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${course.progress}%"></div>
                    </div>
                    <p><strong>Progreso:</strong> ${course.progress}%</p>
                    ${course.rating ? `<p><strong>Calificación:</strong> ${course.rating}/10</p>` : ''}
                    ${course.skills ? `<p><strong>Habilidades:</strong> ${course.skills}</p>` : ''}
                `;
                coursesList.appendChild(courseElement);
            });
        }

        function deleteCourse(index) {
            if (confirm('¿Estás seguro de que quieres eliminar este curso?')) {
                data.courses.splice(index, 1);
                saveData('courses');
                loadCourses();
            }
        }

        // Journal functions
        function loadJournal() {
            const journalList = document.getElementById('journalList');
            journalList.innerHTML = '';

            data.journal.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((entry, index) => {
                const journalElement = document.createElement('div');
                journalElement.className = 'item-card';
                journalElement.innerHTML = `
                    <div class="item-header">
                        <h3 class="item-title">${entry.mood} ${entry.title || 'Entrada del ' + entry.date}</h3>
                        <div class="item-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteJournalEntry(${index})">Eliminar</button>
                        </div>
                    </div>
                    <p><strong>Fecha:</strong> ${entry.date}</p>
                    <p><strong>Reflexiones:</strong> ${entry.content}</p>
                    ${entry.gratitude ? `<p><strong>Gratitud:</strong> ${entry.gratitude}</p>` : ''}
                    <p><strong>Energía:</strong> ${entry.energy}/10 | <strong>Sueño:</strong> ${entry.sleep}/10</p>
                `;
                journalList.appendChild(journalElement);
            });
        }

        function deleteJournalEntry(index) {
            if (confirm('¿Estás seguro de que quieres eliminar esta entrada?')) {
                data.journal.splice(index, 1);
                saveData('journal');
                loadJournal();
            }
        }

        // Form submissions
        document.getElementById('habitForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const frequency = document.getElementById('habitFrequency').value;
            let allowedDays = [];
            
            if (frequency === 'custom') {
                const selectedDays = document.querySelectorAll('.day-checkbox input:checked');
                allowedDays = Array.from(selectedDays).map(input => parseInt(input.value));
                
                if (allowedDays.length === 0) {
                    alert('Por favor selecciona al menos un día de la semana.');
                    return;
                }
            }
            
            const habit = {
                id: Date.now().toString(),
                name: document.getElementById('habitName').value,
                description: document.getElementById('habitDescription').value,
                frequency: frequency,
                category: document.getElementById('habitCategory').value,
                allowedDays: allowedDays,
                completedDates: [],
                createdAt: new Date().toISOString()
            };
            
            data.habits.push(habit);
            saveData('habits');
            closeModal('habitModal');
            loadHabits();
        });

        document.getElementById('incomeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const income = {
                id: Date.now(),
                amount: document.getElementById('incomeAmount').value,
                date: document.getElementById('incomeDate').value,
                description: document.getElementById('incomeDescription').value,
                category: document.getElementById('incomeCategory').value,
                recurring: document.getElementById('incomeRecurring').value,
                createdAt: new Date().toISOString()
            };
            data.incomes.push(income);
            saveData('incomes');
            closeModal('incomeModal');
            updateBalance();
            loadIncomes();
            loadFinanceSummary();
        });

        document.getElementById('expenseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const expense = {
                id: Date.now(),
                amount: document.getElementById('expenseAmount').value,
                date: document.getElementById('expenseDate').value,
                description: document.getElementById('expenseDescription').value,
                category: document.getElementById('expenseCategory').value,
                payment: document.getElementById('expensePayment').value,
                createdAt: new Date().toISOString()
            };
            data.expenses.push(expense);
            saveData('expenses');
            closeModal('expenseModal');
            updateBalance();
            loadExpenses();
            loadFinanceSummary();
        });

        document.getElementById('mediaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const media = {
                id: Date.now(),
                title: document.getElementById('mediaTitle').value,
                type: document.getElementById('mediaType').value,
                year: document.getElementById('mediaYear').value,
                genre: document.getElementById('mediaGenre').value,
                platform: document.getElementById('mediaPlatform').value,
                status: document.getElementById('mediaStatus').value,
                rating: document.getElementById('mediaRating').value,
                review: document.getElementById('mediaReview').value,
                createdAt: new Date().toISOString()
            };
            data.media.push(media);
            saveData('media');
            closeModal('mediaModal');
            loadMedia();
        });

        document.getElementById('bookForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const book = {
                id: Date.now(),
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                pages: document.getElementById('bookPages').value,
                genre: document.getElementById('bookGenre').value,
                format: document.getElementById('bookFormat').value,
                status: document.getElementById('bookStatus').value,
                rating: document.getElementById('bookRating').value,
                notes: document.getElementById('bookNotes').value,
                createdAt: new Date().toISOString()
            };
            data.books.push(book);
            saveData('books');
            closeModal('bookModal');
            loadBooks();
        });

        document.getElementById('courseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const course = {
                id: Date.now(),
                name: document.getElementById('courseName').value,
                instructor: document.getElementById('courseInstructor').value,
                platform: document.getElementById('coursePlatform').value,
                duration: document.getElementById('courseDuration').value,
                progress: document.getElementById('courseProgress').value,
                status: document.getElementById('courseStatus').value,
                rating: document.getElementById('courseRating').value,
                skills: document.getElementById('courseSkills').value,
                createdAt: new Date().toISOString()
            };
            data.courses.push(course);
            saveData('courses');
            closeModal('courseModal');
            loadCourses();
        });

        document.getElementById('journalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const journal = {
                id: Date.now(),
                date: document.getElementById('journalDate').value,
                mood: document.getElementById('journalMood').value,
                title: document.getElementById('journalTitle').value,
                content: document.getElementById('journalContent').value,
                gratitude: document.getElementById('journalGratitude').value,
                energy: document.getElementById('journalEnergy').value,
                sleep: document.getElementById('journalSleep').value,
                createdAt: new Date().toISOString()
            };
            data.journal.push(journal);
            saveData('journal');
            closeModal('journalModal');
            loadJournal();
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });
    </script>
</body>
</html>
